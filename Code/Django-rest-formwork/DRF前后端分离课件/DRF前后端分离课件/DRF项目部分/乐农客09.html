<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.0.5 (458014)"/><meta name="created" content="2019-03-10 10:43:28 +0000"/><meta name="updated" content="2019-03-11 05:35:12 +0000"/><meta name="content-class" content="michalyao.vscode.evermonkey"/><title>乐农客09</title></head><body><!--%EVERMONKEY%IyDotK3nianovabmjqXlj6Porr7orqEKIVvlvq7kv6HmiKrlm75fMjAxOTAzMTAyMDM4MTJdKGh0dHA6Ly9tZC4xMDBjeHkuY29tLyVFNSVCRSVBRSVFNCVCRiVBMSVFNiU4OCVBQSVFNSU5QiVCRV8yMDE5MDMxMDIwMzgxMi5wbmcpCiMjIOa3u+WKoOWVhuWTgeWIsOi0reeJqei9pgojIyMg5bqP5YiX5YyWCmBgYHB5dGhvbgojIHRyYWRlL3NlcmlhbGl6ZXIucHkKX19hdXRob3JfXyA9ICd3ZW5nd2VueXUnCgpmcm9tIC5tb2RlbHMgaW1wb3J0IFNob3BwaW5nQ2FydApmcm9tIHJlc3RfZnJhbWV3b3JrIGltcG9ydCBzZXJpYWxpemVycwpmcm9tIGdvb2RzLm1vZGVscyBpbXBvcnQgR29vZHMKCmNsYXNzIFNob3BDYXJ0U2VyaWFsaXplcihzZXJpYWxpemVycy5TZXJpYWxpemVyKToKICAgICPojrflj5blvZPliY3nmbvlvZXnmoTnlKjmiLcKICAgIHVzZXIgPSBzZXJpYWxpemVycy5IaWRkZW5GaWVsZCgKICAgICAgICBkZWZhdWx0PXNlcmlhbGl6ZXJzLkN1cnJlbnRVc2VyRGVmYXVsdCgpCiAgICApCiAgICBudW1zID0gc2VyaWFsaXplcnMuSW50ZWdlckZpZWxkKHJlcXVpcmVkPVRydWUsIGxhYmVsPSLmlbDph48iLG1pbl92YWx1ZT0xLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlcz17CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWluX3ZhbHVlIjoi5ZWG5ZOB5pWw6YeP5LiN6IO95bCP5LqO5LiAIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJyZXF1aXJlZCI6ICLor7fpgInmi6notK3kubDmlbDph48iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAj6L+Z6YeM5piv57un5om/U2VyaWFsaXplcu+8jOW/hemhu+aMh+WumnF1ZXJ5c2V05a+56LGh77yM5aaC5p6c57un5om/TW9kZWxTZXJpYWxpemVy5YiZ5LiN6ZyA6KaB5oyH5a6aCiAgICAjZ29vZHPmmK/kuIDkuKrlpJbplK7vvIzlj6/ku6XpgJrov4fov5nmlrnms5Xojrflj5Znb29kcyBvYmplY3TkuK3miYDmnInnmoTlgLwKICAgIGdvb2RzID0gc2VyaWFsaXplcnMuUHJpbWFyeUtleVJlbGF0ZWRGaWVsZChyZXF1aXJlZD1UcnVlLCBxdWVyeXNldD1Hb29kcy5vYmplY3RzLmFsbCgpKQoKICAgICPnu6fmib/nmoRTZXJpYWxpemVy5rKh5pyJc2F2ZeWKn+iDve+8jOW/hemhu+WGmeS4gOS4qmNyZWF0ZeaWueazlQogICAgZGVmIGNyZWF0ZShzZWxmLCB2YWxpZGF0ZWRfZGF0YSk6CiAgICAgICAgIyB2YWxpZGF0ZWRfZGF0YeaYr+W3sue7j+WkhOeQhui/h+eahOaVsOaNrgogICAgICAgICMg6I635Y+W5b2T5YmN55So5oi3CiAgICAgICAgIyB2aWV35LitOnNlbGYucmVxdWVzdC51c2Vy77ybc2VyaXpsaXplcuS4rTpzZWxmLmNvbnRleHRbInJlcXVlc3QiXS51c2VyCiAgICAgICAgdXNlciA9IHNlbGYuY29udGV4dFsicmVxdWVzdCJdLnVzZXIKICAgICAgICBudW1zID0gdmFsaWRhdGVkX2RhdGFbIm51bXMiXQogICAgICAgIGdvb2RzID0gdmFsaWRhdGVkX2RhdGFbImdvb2RzIl0KCiAgICAgICAgIyDljrvmlbDmja7lupPph4zpnaLnnIt1c2Vy6L+Z5Liq55So5oi3LGdvb2Rz6L+Z5Liq5ZWG5ZOBLOacieayoeacieiusOW9lSzmnInlsLHmiororrDlvZXlj5blh7rmnaUKICAgICAgICAjIOavlOWmgiDlvKDkuInlt7Lnu4/kubDkuoboi7nmnpws5Zyo6LSt54mp6L2m6L+Z5byg6KGo6YeM6Z2i5bCx5pyJ5LmL5YmN55qE55qE6Iu55p6c55qE5pWw6YeP55qE6K6w5b2VIAogICAgICAgIGV4aXN0ZWQgPSBTaG9wcGluZ0NhcnQub2JqZWN0cy5maWx0ZXIodXNlcj11c2VyLCBnb29kcz1nb29kcykKICAgICAgICAj5aaC5p6c6LSt54mp6L2m5Lit5pyJ6K6w5b2V77yM5pWw6YePKzEKICAgICAgICAj5aaC5p6c6LSt54mp6L2m6L2m5rKh5pyJ6K6w5b2V77yM5bCx5Yib5bu6CiAgICAgICAgaWYgZXhpc3RlZDoKICAgICAgICAgICAgZXhpc3RlZCA9IGV4aXN0ZWRbMF0KICAgICAgICAgICAgZXhpc3RlZC5udW1zICs9IG51bXMKICAgICAgICAgICAgZXhpc3RlZC5zYXZlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICAj5re75Yqg5Yiw6LSt54mp6L2mCiAgICAgICAgICAgIGV4aXN0ZWQgPSBTaG9wcGluZ0NhcnQub2JqZWN0cy5jcmVhdGUoKip2YWxpZGF0ZWRfZGF0YSkKCiAgICAgICAgcmV0dXJuIGV4aXN0ZWQKYGBgCiMjIyDop4blm74KYGBgcHl0aG9uCiMgdHJhZGUvdmlld3MucHkKCmZyb20gcmVzdF9mcmFtZXdvcmsgaW1wb3J0IHZpZXdzZXRzCmZyb20gcmVzdF9mcmFtZXdvcmsucGVybWlzc2lvbnMgaW1wb3J0IElzQXV0aGVudGljYXRlZApmcm9tIHV0aWxzLnBlcm1pc3Npb25zIGltcG9ydCBJc093bmVyT3JSZWFkT25seQpmcm9tIHJlc3RfZnJhbWV3b3JrX2p3dC5hdXRoZW50aWNhdGlvbiBpbXBvcnQgSlNPTldlYlRva2VuQXV0aGVudGljYXRpb24KZnJvbSByZXN0X2ZyYW1ld29yay5hdXRoZW50aWNhdGlvbiBpbXBvcnQgU2Vzc2lvbkF1dGhlbnRpY2F0aW9uCmZyb20gLnNlcmlhbGl6ZXJzIGltcG9ydCBTaG9wQ2FydFNlcmlhbGl6ZXIKZnJvbSAubW9kZWxzIGltcG9ydCBTaG9wcGluZ0NhcnQKCmNsYXNzIFNob3BwaW5nQ2FydFZpZXdzZXQodmlld3NldHMuTW9kZWxWaWV3U2V0KToKICAgICIiIgogICAg6LSt54mp6L2m5Yqf6IO9CiAgICBsaXN0OgogICAgICAgIOiOt+WPlui0reeJqei9puivpuaDhQogICAgY3JlYXRl77yaCiAgICAgICAg5Yqg5YWl6LSt54mp6L2mCiAgICBkZWxldGXvvJoKICAgICAgICDliKDpmaTotK3nianorrDlvZUKICAgICIiIgogICAgcGVybWlzc2lvbl9jbGFzc2VzID0gKElzQXV0aGVudGljYXRlZCwgSXNPd25lck9yUmVhZE9ubHkpCiAgICBhdXRoZW50aWNhdGlvbl9jbGFzc2VzID0gKEpTT05XZWJUb2tlbkF1dGhlbnRpY2F0aW9uLCBTZXNzaW9uQXV0aGVudGljYXRpb24pCgogICAgc2VyaWFsaXplcl9jbGFzcyA9IFNob3BDYXJ0U2VyaWFsaXplcgoKICAgIGRlZiBnZXRfcXVlcnlzZXQoc2VsZik6CiAgICAgICAgcmV0dXJuIFNob3BwaW5nQ2FydC5vYmplY3RzLmZpbHRlcih1c2VyPXNlbGYucmVxdWVzdC51c2VyKQpgYGAKIyMjIOmFjee9rlVSTCAKYGBgcHl0aG9uCiMg6YWN572u6LSt54mp6L2m55qEdXJsCnJvdXRlci5yZWdpc3RlcihyJ3Nob3BjYXJ0cycsIFNob3BwaW5nQ2FydFZpZXdzZXQsIGJhc2VfbmFtZT0ic2hvcGNhcnRzIikKYGBgCgohW+W+ruS/oeaIquWbvl8yMDE5MDMxMDE5NTI0NV0oaHR0cDovL21kLjEwMGN4eS5jb20vJUU1JUJFJUFFJUU0JUJGJUExJUU2JTg4JUFBJUU1JTlCJUJFXzIwMTkwMzEwMTk1MjQ1LnBuZykKCiFb5b6u5L+h5oiq5Zu+XzIwMTkwMzEwMjAwNjAyXShodHRwOi8vbWQuMTAwY3h5LmNvbS8lRTUlQkUlQUUlRTQlQkYlQTElRTYlODglQUElRTUlOUIlQkVfMjAxOTAzMTAyMDA2MDIucG5nKQoKIVvlvq7kv6HmiKrlm75fMjAxOTAzMTAyMDA3MTldKGh0dHA6Ly9tZC4xMDBjeHkuY29tLyVFNSVCRSVBRSVFNCVCRiVBMSVFNiU4OCVBQSVFNSU5QiVCRV8yMDE5MDMxMDIwMDcxOS5wbmcpCgoKIyMg5re75Yqg6LSt54mp6L2m5pWw6YePIApTZXJpYWxpemVy57un5om/QmFzZVNlcmlhbGl6ZXLvvIzkvYbmmK9TZXJpYXplcuS4reW5tuayoeaciemHjeaWsHVwZGF0ZeaWueazle+8jOaJgOaciea3u+WKoOS4gOS4qnVwZGF0ZeaWueazlQpgYGBweXRob24KIGRlZiB1cGRhdGUoc2VsZiwgaW5zdGFuY2UsIHZhbGlkYXRlZF9kYXRhKToKICAgICAgICAjIOS/ruaUueWVhuWTgeaVsOmHjwogICAgICAgIGluc3RhbmNlLm51bXMgPSB2YWxpZGF0ZWRfZGF0YVsibnVtcyJdCiAgICAgICAgaW5zdGFuY2Uuc2F2ZSgpCiAgICAgICAgcmV0dXJuIGluc3RhbmNlCmBgYArlnKh2aWV35Lit6KaB5oqK5ZWG5ZOBaWTkvKDov4fljrsKYGBgcHl0aG9uCiBsb29rdXBfZmllbGQgPSAiZ29vZHNfaWQiCmBgYAojIyBWdWXlkozotK3nianovabmjqXlj6PogZTosIMgCgohW+W+ruS/oeaIquWbvl8yMDE5MDMxMDIwMzAxMF0oaHR0cDovL21kLjEwMGN4eS5jb20vJUU1JUJFJUFFJUU0JUJGJUExJUU2JTg4JUFBJUU1JTlCJUJFXzIwMTkwMzEwMjAzMDEwLnBuZykKCui0reeJqei9puS4reWPr+S7peeci+WVhuWTgeivpuaDhe+8jOmcgOimgeWGmeS4gOS4quWVhuWTgeivpuaDheeahHNlcmlhbGl6ZXIs5omA5pyJ5Zyodmlld+S4remcgOimgeWKqOaAgeiuvue9rnNlcmlhbGl6ZXIKYGBgcHl0aG9uCmNsYXNzIFNob3BDYXJ0RGV0YWlsU2VyaWFsaXplcihzZXJpYWxpemVycy5Nb2RlbFNlcmlhbGl6ZXIpOgogICAgJycnCiAgICDotK3nianovabllYblk4Hor6bmg4Xkv6Hmga8KICAgICcnJwogICAgIyDkuIDkuKrotK3nianovablr7nlupTkuIDkuKrllYblk4EKICAgIGdvb2RzID0gR29vZHNTZXJpYWxpemVyKG1hbnk9RmFsc2UsIHJlYWRfb25seT1UcnVlKQogICAgY2xhc3MgTWV0YToKICAgICAgICBtb2RlbCA9IFNob3BwaW5nQ2FydAogICAgICAgIGZpZWxkcyA9ICgiZ29vZHMiLCAibnVtcyIpCmBgYArpnIDopoHliqjmgIHpgInmi6lzZXJpYWxpemVyCgpgYGBweXRob24KZGVmIGdldF9zZXJpYWxpemVyX2NsYXNzKHNlbGYpOgogICAgICAgIGlmIHNlbGYuYWN0aW9uID09ICdsaXN0JzoKICAgICAgICAgICAgcmV0dXJuIFNob3BDYXJ0RGV0YWlsU2VyaWFsaXplcgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJldHVybiBTaG9wQ2FydFNlcmlhbGl6ZXIKYGBgCgohW+W+ruS/oeaIquWbvl8yMDE5MDMxMDIwMzgxMl0oaHR0cDovL21kLjEwMGN4eS5jb20vJUU1JUJFJUFFJUU0JUJGJUExJUU2JTg4JUFBJUU1JTlCJUJFXzIwMTkwMzEwMjAzODEyLnBuZykKCg==%EVERMONKEY%--><div style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; color: #333; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial,freesans, sans-serif,微软雅黑,Heiti SC Light,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol !important; font-size: 26px !important; line-height: 1.6; margin-bottom: 50px; word-wrap: break-word;"><h1 style="border-bottom: 1px solid #eee; box-sizing: border-box; font-size: 32px; font-weight: bold; line-height: 1.2; margin: 0.67em 0; margin-bottom: 16px; margin-top: 0 !important; padding-bottom: 0.3em;">购物车接口设计</h1>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310203812.png" alt="微信截图_20190310203812" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
<h2 style="border-bottom: 1px solid #eee; box-sizing: border-box; font-size: 28px; font-weight: bold; line-height: 1.225; margin-bottom: 16px; margin-top: 1em; padding-bottom: 0.3em;">添加商品到购物车</h2>
<h3 style="box-sizing: border-box; font-size: 24px; font-weight: bold; line-height: 1.43; margin-bottom: 16px; margin-top: 1em;">序列化</h3>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"><span style="box-sizing: border-box; color: #998; font-style: italic;"># trade/serializer.py</span>
__author__ = <span style="box-sizing: border-box; color: #d14;">'wengwenyu'</span>

<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> .models <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> ShoppingCart
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> rest_framework <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> serializers
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> goods.models <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> Goods

<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">class</span> <span style="box-sizing: border-box; color: #458; font-weight: bold;">ShopCartSerializer</span><span style="box-sizing: border-box;">(serializers.Serializer)</span>:</span>
    <span style="box-sizing: border-box; color: #998; font-style: italic;">#获取当前登录的用户</span>
    user = serializers.HiddenField(
        default=serializers.CurrentUserDefault()
    )
    nums = serializers.IntegerField(required=<span style="box-sizing: border-box; color: #333; font-weight: bold;">True</span>, label=<span style="box-sizing: border-box; color: #d14;">"数量"</span>,min_value=<span style="box-sizing: border-box; color: #008080;">1</span>,
                                    error_messages={
                                        <span style="box-sizing: border-box; color: #d14;">"min_value"</span>:<span style="box-sizing: border-box; color: #d14;">"商品数量不能小于一"</span>,
                                        <span style="box-sizing: border-box; color: #d14;">"required"</span>: <span style="box-sizing: border-box; color: #d14;">"请选择购买数量"</span>
                                    })
    <span style="box-sizing: border-box; color: #998; font-style: italic;">#这里是继承Serializer，必须指定queryset对象，如果继承ModelSerializer则不需要指定</span>
    <span style="box-sizing: border-box; color: #998; font-style: italic;">#goods是一个外键，可以通过这方法获取goods object中所有的值</span>
    goods = serializers.PrimaryKeyRelatedField(required=<span style="box-sizing: border-box; color: #333; font-weight: bold;">True</span>, queryset=Goods.objects.all())

    <span style="box-sizing: border-box; color: #998; font-style: italic;">#继承的Serializer没有save功能，必须写一个create方法</span>
    <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">def</span> <span style="box-sizing: border-box; color: #900; font-weight: bold;">create</span><span style="box-sizing: border-box;">(self, validated_data)</span>:</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;"># validated_data是已经处理过的数据</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;"># 获取当前用户</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;"># view中:self.request.user；serizlizer中:self.context["request"].user</span>
        user = self.context[<span style="box-sizing: border-box; color: #d14;">"request"</span>].user
        nums = validated_data[<span style="box-sizing: border-box; color: #d14;">"nums"</span>]
        goods = validated_data[<span style="box-sizing: border-box; color: #d14;">"goods"</span>]

        <span style="box-sizing: border-box; color: #998; font-style: italic;"># 去数据库里面看user这个用户,goods这个商品,有没有记录,有就把记录取出来</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;"># 比如 张三已经买了苹果,在购物车这张表里面就有之前的的苹果的数量的记录 </span>
        existed = ShoppingCart.objects.filter(user=user, goods=goods)
        <span style="box-sizing: border-box; color: #998; font-style: italic;">#如果购物车中有记录，数量+1</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;">#如果购物车车没有记录，就创建</span>
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">if</span> existed:
            existed = existed[<span style="box-sizing: border-box; color: #008080;">0</span>]
            existed.nums += nums
            existed.save()
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">else</span>:
            <span style="box-sizing: border-box; color: #998; font-style: italic;">#添加到购物车</span>
            existed = ShoppingCart.objects.create(**validated_data)

        <span style="box-sizing: border-box; color: #333; font-weight: bold;">return</span> existed
</code></pre>
<h3 style="box-sizing: border-box; font-size: 24px; font-weight: bold; line-height: 1.43; margin-bottom: 16px; margin-top: 1em;">视图</h3>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"><span style="box-sizing: border-box; color: #998; font-style: italic;"># trade/views.py</span>

<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> rest_framework <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> viewsets
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> rest_framework.permissions <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> IsAuthenticated
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> utils.permissions <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> IsOwnerOrReadOnly
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> rest_framework_jwt.authentication <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> JSONWebTokenAuthentication
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> rest_framework.authentication <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> SessionAuthentication
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> .serializers <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> ShopCartSerializer
<span style="box-sizing: border-box; color: #333; font-weight: bold;">from</span> .models <span style="box-sizing: border-box; color: #333; font-weight: bold;">import</span> ShoppingCart

<span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">class</span> <span style="box-sizing: border-box; color: #458; font-weight: bold;">ShoppingCartViewset</span><span style="box-sizing: border-box;">(viewsets.ModelViewSet)</span>:</span>
    <span style="box-sizing: border-box; color: #d14;">"""
    购物车功能
    list:
        获取购物车详情
    create：
        加入购物车
    delete：
        删除购物记录
    """</span>
    permission_classes = (IsAuthenticated, IsOwnerOrReadOnly)
    authentication_classes = (JSONWebTokenAuthentication, SessionAuthentication)

    serializer_class = ShopCartSerializer

    <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">def</span> <span style="box-sizing: border-box; color: #900; font-weight: bold;">get_queryset</span><span style="box-sizing: border-box;">(self)</span>:</span>
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">return</span> ShoppingCart.objects.filter(user=self.request.user)
</code></pre>
<h3 style="box-sizing: border-box; font-size: 24px; font-weight: bold; line-height: 1.43; margin-bottom: 16px; margin-top: 1em;">配置URL</h3>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"><span style="box-sizing: border-box; color: #998; font-style: italic;"># 配置购物车的url</span>
router.register(<span style="box-sizing: border-box; color: #d14;">r'shopcarts'</span>, ShoppingCartViewset, base_name=<span style="box-sizing: border-box; color: #d14;">"shopcarts"</span>)
</code></pre>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310195245.png" alt="微信截图_20190310195245" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310200602.png" alt="微信截图_20190310200602" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310200719.png" alt="微信截图_20190310200719" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
<h2 style="border-bottom: 1px solid #eee; box-sizing: border-box; font-size: 28px; font-weight: bold; line-height: 1.225; margin-bottom: 16px; margin-top: 1em; padding-bottom: 0.3em;">添加购物车数量</h2>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;">Serializer继承BaseSerializer，但是Seriazer中并没有重新update方法，所有添加一个update方法</p>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"> <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">def</span> <span style="box-sizing: border-box; color: #900; font-weight: bold;">update</span><span style="box-sizing: border-box;">(self, instance, validated_data)</span>:</span>
        <span style="box-sizing: border-box; color: #998; font-style: italic;"># 修改商品数量</span>
        instance.nums = validated_data[<span style="box-sizing: border-box; color: #d14;">"nums"</span>]
        instance.save()
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">return</span> instance
</code></pre>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;">在view中要把商品id传过去</p>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"> lookup_field = <span style="box-sizing: border-box; color: #d14;">"goods_id"</span>
</code></pre>
<h2 style="border-bottom: 1px solid #eee; box-sizing: border-box; font-size: 28px; font-weight: bold; line-height: 1.225; margin-bottom: 16px; margin-top: 1em; padding-bottom: 0.3em;">Vue和购物车接口联调</h2>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310203010.png" alt="微信截图_20190310203010" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;">购物车中可以看商品详情，需要写一个商品详情的serializer,所有在view中需要动态设置serializer</p>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"><span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">class</span> <span style="box-sizing: border-box; color: #458; font-weight: bold;">ShopCartDetailSerializer</span><span style="box-sizing: border-box;">(serializers.ModelSerializer)</span>:</span>
    <span style="box-sizing: border-box; color: #d14;">'''
    购物车商品详情信息
    '''</span>
    <span style="box-sizing: border-box; color: #998; font-style: italic;"># 一个购物车对应一个商品</span>
    goods = GoodsSerializer(many=<span style="box-sizing: border-box; color: #333; font-weight: bold;">False</span>, read_only=<span style="box-sizing: border-box; color: #333; font-weight: bold;">True</span>)
    <span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">class</span> <span style="box-sizing: border-box; color: #458; font-weight: bold;">Meta</span>:</span>
        model = ShoppingCart
        fields = (<span style="box-sizing: border-box; color: #d14;">"goods"</span>, <span style="box-sizing: border-box; color: #d14;">"nums"</span>)
</code></pre>
<p style="box-sizing: border-box; margin-bottom: 16px; margin-top: 0;">需要动态选择serializer</p>
<pre style="background: #f8f8f8; border-radius: 3px; box-sizing: border-box; color: #333; display: block; font: 12px Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-family: Helvetica Neue,Helvetica,Segoe UI,Arial !important; font-size: 18px !important; line-height: 1.45; margin-bottom: 16px; margin-top: 0; overflow: auto; overflow-x: auto; padding: 16px; word-wrap: normal;"><code style="background: transparent; background-color: transparent; border: 0; border-radius: 3px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 100%; line-height: inherit; margin: 0; max-width: initial; overflow: initial; padding: 0; padding-bottom: 0.2em; padding-top: 0.2em; white-space: pre; word-break: normal; word-wrap: normal;"><span style="box-sizing: border-box;"><span style="box-sizing: border-box; color: #333; font-weight: bold;">def</span> <span style="box-sizing: border-box; color: #900; font-weight: bold;">get_serializer_class</span><span style="box-sizing: border-box;">(self)</span>:</span>
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">if</span> self.action == <span style="box-sizing: border-box; color: #d14;">'list'</span>:
            <span style="box-sizing: border-box; color: #333; font-weight: bold;">return</span> ShopCartDetailSerializer
        <span style="box-sizing: border-box; color: #333; font-weight: bold;">else</span>:
            <span style="box-sizing: border-box; color: #333; font-weight: bold;">return</span> ShopCartSerializer
</code></pre>
<p style="box-sizing: border-box; margin-bottom: 0 !important; margin-top: 0;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190310203812.png" alt="微信截图_20190310203812" style="background-color: #fff; border-style: none; box-sizing: content-box; max-width: 100%;"/></p>
</div></body></html>