<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.0.5 (458014)"/><meta name="altitude" content="37.39571762084961"/><meta name="author" content="李居豪"/><meta name="created" content="2019-04-23 02:20:03 +0000"/><meta name="latitude" content="39.62996778867593"/><meta name="longitude" content="116.0482155605452"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-04-23 02:21:30 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>DRF进阶06</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">版本控制</h1>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">模型类设计</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.db <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> models


<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Create your models here.</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UserGroup</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">32</span>, verbose_name=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'用户组名'</span>)


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">Role</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">32</span>, verbose_name=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"角色"</span>)


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UserInfo</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    user_type_choices = (
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"普通用户"</span>),
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"VIP"</span>),
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"SVIP"</span>)
    )
    user_type = models.IntegerField(choices=user_type_choices, verbose_name=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"用户类型"</span>)

    username = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">32</span>, unique=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
    password = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">256</span>)

    group = models.ForeignKey(UserGroup, verbose_name=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"用户类型"</span>)
    roles = models.ManyToManyField(Role)


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UserToken</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    user = models.OneToOneField(UserInfo)
    token = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">256</span>)
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">设计url(我们可以设计路由分发)</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.conf.urls <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> url, include
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.contrib <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> admin

urlpatterns = [
    url(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">r'^admin/'</span>, admin.site.urls),
    url(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">r'^api/'</span>,include(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"api.urls"</span>))
]

</code></pre>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.conf.urls <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> url
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> .views <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> UsersView
urlpatterns = [
    url(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">r'^users/$'</span>, UsersView.as_view())
]
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">设计视图</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.http <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> JsonResponse
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> rest_framework.views <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> APIView


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UsersView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># version = request._request.GET.get("version")</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># version = request.query_params.get('version')</span>
        version = request.GET.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"version"</span>)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse({<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'version'</span>: version})
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">浏览器效果</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115201347.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">使用get传参</h1>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">自定义版本处理</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">ParamVersion</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(object)</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">determine_version</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># version = request._request.GET.get("version")</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># version = request.query_params.get('version')</span>
        version = request.GET.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"version"</span>)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> version
</code></pre>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UsersView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    versioning_class = ParamVersion

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        version = request.version
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse({<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'version'</span>: version})
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">浏览器效果</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115202414.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">使用内置版本组件</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> rest_framework.versioning <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> QueryParameterVersioning

<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UsersView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    versioning_class = QueryParameterVersioning

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        version = request.version
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse({<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'version'</span>: version})
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">浏览器效果</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115202821.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">源代码</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">QueryParameterVersioning</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(BaseVersioning)</span>:</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""
    GET /something/?version=0.1 HTTP/1.1
    Host: example.com
    Accept: application/json
    """</span>
    invalid_version_message = _(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'Invalid version in query parameter.'</span>)

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">determine_version</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># self.default_version默认版本,可以去settings里面配置</span>
        version = request.query_params.get(self.version_param, self.default_version)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 允许的版本 </span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> self.is_allowed_version(version):
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">raise</span> exceptions.NotFound(self.invalid_version_message)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> version

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">reverse</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, viewname, args=None, kwargs=None, request=None, format=None, **extra)</span>:</span>
        url = super(QueryParameterVersioning, self).reverse(
            viewname, args, kwargs, request, format, **extra
        )
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> request.version <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">is</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>:
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> replace_query_param(url, self.version_param, request.version)
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> url
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">跟DRF有关配置</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 跟DRF有关配置</span>
REST_FRAMEWORK = {
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"DEFAULT_VERSION"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v1"</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"ALLOWED_VERSIONS"</span>: [<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v1"</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v2"</span>],
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"VERSION_PARAM"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"version"</span>
}
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">需要加一个渲染器(暂时可以不知道)</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">INSTALLED_APPS = [
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.admin'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.auth'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.contenttypes'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.sessions'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.messages'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'django.contrib.staticfiles'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'myapp.apps.MyappConfig'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'api'</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'rest_framework'</span>
]
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">浏览器效果</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115203750.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115203823.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">在URL路径中传参,先修改视图</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> rest_framework.versioning <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> URLPathVersioning


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UsersView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    versioning_class = URLPathVersioning

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        version = request.version
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse({<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'version'</span>: version})
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">修改url</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"> url(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">r'^(?P&lt;version&gt;[v1|v2]+)/users/'</span>, views.UsersView.as_view())
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204258.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">写进配置文件里面</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">REST_FRAMEWORK = {
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"DEFAULT_VERSIONING_CLASS"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"rest_framework.versioning.URLPathVersioning"</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"DEFAULT_VERSION"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v1"</span>,
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"ALLOWED_VERSIONS"</span>: [<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v1"</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"v2"</span>],
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"VERSION_PARAM"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"version"</span>
}

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204655.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204737.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">一般会在URL传参(推荐)</h1>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223441.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223726.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">修改url</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223835.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">写进配置文件里面</li>
</ul>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">源码流程</h1>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">dispatch方法里面</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205114.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">调用了determine_version方法</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205159.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205246.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">determine_version</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""
        If versioning is being used, then determine any API version for the
        incoming request. Returns a two-tuple of (version, versioning_scheme)
        """</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> self.versioning_class <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">is</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>:
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>, <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 处理版本类的对象:URLPathVersioning对象</span>
        scheme = self.versioning_class()
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">#  该元组的第一个元素返回这个对象的determine_version方法 第二个参数返回scheme</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (scheme.determine_version(request, *args, **kwargs), scheme)
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">返回版本<br/>
<img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225139.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/><br/>
<img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225305.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205636.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">反向生成URL</h1>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225904.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">增加一个name参数</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  url(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">r'^(?P&lt;version&gt;[v1|v2]+)/users/'</span>, views.UsersView.as_view(),name=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'user'</span>)
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115211352.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">为什么DRF的reverse带版本<br/>
<img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221230802.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></li>
</ul>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%20%20%0A%0A-%20%E6%A8%A1%E5%9E%8B%E7%B1%BB%E8%AE%BE%E8%AE%A1%20%0A%60%60%60python%20%0Afrom%20django.db%20import%20models%0A%0A%0A%23%20Create%20your%20models%20here.%0Aclass%20UserGroup(models.Model)%3A%0A%20%20%20%20title%20%3D%20models.CharField(max_length%3D32%2C%20verbose_name%3D'%E7%94%A8%E6%88%B7%E7%BB%84%E5%90%8D')%0A%0A%0Aclass%20Role(models.Model)%3A%0A%20%20%20%20title%20%3D%20models.CharField(max_length%3D32%2C%20verbose_name%3D%22%E8%A7%92%E8%89%B2%22)%0A%0A%0Aclass%20UserInfo(models.Model)%3A%0A%20%20%20%20user_type_choices%20%3D%20(%0A%20%20%20%20%20%20%20%20(1%2C%20%22%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%22)%2C%0A%20%20%20%20%20%20%20%20(2%2C%20%22VIP%22)%2C%0A%20%20%20%20%20%20%20%20(3%2C%20%22SVIP%22)%0A%20%20%20%20)%0A%20%20%20%20user_type%20%3D%20models.IntegerField(choices%3Duser_type_choices%2C%20verbose_name%3D%22%E7%94%A8%E6%88%B7%E7%B1%BB%E5%9E%8B%22)%0A%0A%20%20%20%20username%20%3D%20models.CharField(max_length%3D32%2C%20unique%3DTrue)%0A%20%20%20%20password%20%3D%20models.CharField(max_length%3D256)%0A%0A%20%20%20%20group%20%3D%20models.ForeignKey(UserGroup%2C%20verbose_name%3D%22%E7%94%A8%E6%88%B7%E7%B1%BB%E5%9E%8B%22)%0A%20%20%20%20roles%20%3D%20models.ManyToManyField(Role)%0A%0A%0Aclass%20UserToken(models.Model)%3A%0A%20%20%20%20user%20%3D%20models.OneToOneField(UserInfo)%0A%20%20%20%20token%20%3D%20models.CharField(max_length%3D256)%0A%60%60%60%0A-%20%E8%AE%BE%E8%AE%A1url(%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%AE%BE%E8%AE%A1%E8%B7%AF%E7%94%B1%E5%88%86%E5%8F%91)%0A%60%60%60python%0Afrom%20django.conf.urls%20import%20url%2C%20include%0Afrom%20django.contrib%20import%20admin%0A%0Aurlpatterns%20%3D%20%5B%0A%20%20%20%20url(r'%5Eadmin%2F'%2C%20admin.site.urls)%2C%0A%20%20%20%20url(r'%5Eapi%2F'%2Cinclude(%22api.urls%22))%0A%5D%0A%0A%60%60%60%0A%60%60%60python%0Afrom%20django.conf.urls%20import%20url%0Afrom%20.views%20import%20UsersView%0Aurlpatterns%20%3D%20%5B%0A%20%20%20%20url(r'%5Eusers%2F%24'%2C%20UsersView.as_view())%0A%5D%0A%60%60%60%0A-%20%E8%AE%BE%E8%AE%A1%E8%A7%86%E5%9B%BE%20%20%0A%60%60%60python%0Afrom%20django.http%20import%20JsonResponse%0Afrom%20rest_framework.views%20import%20APIView%0A%0A%0Aclass%20UsersView(APIView)%3A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%23%20version%20%3D%20request._request.GET.get(%22version%22)%0A%20%20%20%20%20%20%20%20%23%20version%20%3D%20request.query_params.get('version')%0A%20%20%20%20%20%20%20%20version%20%3D%20request.GET.get(%22version%22)%0A%20%20%20%20%20%20%20%20return%20JsonResponse(%7B'version'%3A%20version%7D)%0A%60%60%60%0A-%20%E6%B5%8F%E8%A7%88%E5%99%A8%E6%95%88%E6%9E%9C%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115201347%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115201347.png)%0A%0A%23%20%E4%BD%BF%E7%94%A8get%E4%BC%A0%E5%8F%82%0A-%20%E8%87%AA%E5%AE%9A%E4%B9%89%E7%89%88%E6%9C%AC%E5%A4%84%E7%90%86%20%0A%0A%60%60%60python%0Aclass%20ParamVersion(object)%3A%0A%20%20%20%20def%20determine_version(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%23%20version%20%3D%20request._request.GET.get(%22version%22)%0A%20%20%20%20%20%20%20%20%23%20version%20%3D%20request.query_params.get('version')%0A%20%20%20%20%20%20%20%20version%20%3D%20request.GET.get(%22version%22)%0A%20%20%20%20%20%20%20%20return%20version%0A%60%60%60%0A%0A%60%60%60python%0Aclass%20UsersView(APIView)%3A%0A%20%20%20%20versioning_class%20%3D%20ParamVersion%0A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20version%20%3D%20request.version%0A%20%20%20%20%20%20%20%20return%20JsonResponse(%7B'version'%3A%20version%7D)%0A%60%60%60%0A%0A-%20%E6%B5%8F%E8%A7%88%E5%99%A8%E6%95%88%E6%9E%9C%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115202414%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115202414.png)%0A%0A-%20%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E7%89%88%E6%9C%AC%E7%BB%84%E4%BB%B6%20%0A%0A%60%60%60python%0Afrom%20rest_framework.versioning%20import%20QueryParameterVersioning%0A%0Aclass%20UsersView(APIView)%3A%0A%20%20%20%20versioning_class%20%3D%20QueryParameterVersioning%0A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20version%20%3D%20request.version%0A%20%20%20%20%20%20%20%20return%20JsonResponse(%7B'version'%3A%20version%7D)%0A%60%60%60%0A%0A-%20%E6%B5%8F%E8%A7%88%E5%99%A8%E6%95%88%E6%9E%9C%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115202821%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115202821.png)%0A%0A-%20%E6%BA%90%E4%BB%A3%E7%A0%81%0A%60%60%60python%0Aclass%20QueryParameterVersioning(BaseVersioning)%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20GET%20%2Fsomething%2F%3Fversion%3D0.1%20HTTP%2F1.1%0A%20%20%20%20Host%3A%20example.com%0A%20%20%20%20Accept%3A%20application%2Fjson%0A%20%20%20%20%22%22%22%0A%20%20%20%20invalid_version_message%20%3D%20_('Invalid%20version%20in%20query%20parameter.')%0A%0A%20%20%20%20def%20determine_version(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%23%20self.default_version%E9%BB%98%E8%AE%A4%E7%89%88%E6%9C%AC%2C%E5%8F%AF%E4%BB%A5%E5%8E%BBsettings%E9%87%8C%E9%9D%A2%E9%85%8D%E7%BD%AE%0A%20%20%20%20%20%20%20%20version%20%3D%20request.query_params.get(self.version_param%2C%20self.default_version)%0A%20%20%20%20%20%20%20%20%23%20%E5%85%81%E8%AE%B8%E7%9A%84%E7%89%88%E6%9C%AC%20%0A%20%20%20%20%20%20%20%20if%20not%20self.is_allowed_version(version)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20exceptions.NotFound(self.invalid_version_message)%0A%20%20%20%20%20%20%20%20return%20version%0A%0A%20%20%20%20def%20reverse(self%2C%20viewname%2C%20args%3DNone%2C%20kwargs%3DNone%2C%20request%3DNone%2C%20format%3DNone%2C%20**extra)%3A%0A%20%20%20%20%20%20%20%20url%20%3D%20super(QueryParameterVersioning%2C%20self).reverse(%0A%20%20%20%20%20%20%20%20%20%20%20%20viewname%2C%20args%2C%20kwargs%2C%20request%2C%20format%2C%20**extra%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20if%20request.version%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20replace_query_param(url%2C%20self.version_param%2C%20request.version)%0A%20%20%20%20%20%20%20%20return%20url%0A%60%60%60%0A-%20%E8%B7%9FDRF%E6%9C%89%E5%85%B3%E9%85%8D%E7%BD%AE%20%0A%0A%60%60%60python%0A%23%20%E8%B7%9FDRF%E6%9C%89%E5%85%B3%E9%85%8D%E7%BD%AE%0AREST_FRAMEWORK%20%3D%20%7B%0A%20%20%20%20%22DEFAULT_VERSION%22%3A%20%22v1%22%2C%0A%20%20%20%20%22ALLOWED_VERSIONS%22%3A%20%5B%22v1%22%2C%20%22v2%22%5D%2C%0A%20%20%20%20%22VERSION_PARAM%22%3A%20%22version%22%0A%7D%0A%60%60%60%0A-%20%E9%9C%80%E8%A6%81%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%B8%B2%E6%9F%93%E5%99%A8(%E6%9A%82%E6%97%B6%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%9F%A5%E9%81%93)%20%0A%60%60%60python%0AINSTALLED_APPS%20%3D%20%5B%0A%20%20%20%20'django.contrib.admin'%2C%0A%20%20%20%20'django.contrib.auth'%2C%0A%20%20%20%20'django.contrib.contenttypes'%2C%0A%20%20%20%20'django.contrib.sessions'%2C%0A%20%20%20%20'django.contrib.messages'%2C%0A%20%20%20%20'django.contrib.staticfiles'%2C%0A%20%20%20%20'myapp.apps.MyappConfig'%2C%0A%20%20%20%20'api'%2C%0A%20%20%20%20'rest_framework'%0A%5D%0A%60%60%60%0A-%20%E6%B5%8F%E8%A7%88%E5%99%A8%E6%95%88%E6%9E%9C%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115203750%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115203750.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115203823%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115203823.png)%0A%0A-%20%E5%9C%A8URL%E8%B7%AF%E5%BE%84%E4%B8%AD%E4%BC%A0%E5%8F%82%2C%E5%85%88%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE%20%0A%60%60%60python%0Afrom%20rest_framework.versioning%20import%20URLPathVersioning%0A%0A%0Aclass%20UsersView(APIView)%3A%0A%20%20%20%20versioning_class%20%3D%20URLPathVersioning%0A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20version%20%3D%20request.version%0A%20%20%20%20%20%20%20%20return%20JsonResponse(%7B'version'%3A%20version%7D)%0A%60%60%60%0A-%20%E4%BF%AE%E6%94%B9url%20%0A%0A%60%60%60python%0A%20url(r'%5E(%3FP%3Cversion%3E%5Bv1%7Cv2%5D%2B)%2Fusers%2F'%2C%20views.UsersView.as_view())%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204258%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115204258.png)%0A%0A-%20%E5%86%99%E8%BF%9B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%20%0A%60%60%60python%0AREST_FRAMEWORK%20%3D%20%7B%0A%20%20%20%20%22DEFAULT_VERSIONING_CLASS%22%3A%20%22rest_framework.versioning.URLPathVersioning%22%2C%0A%20%20%20%20%22DEFAULT_VERSION%22%3A%20%22v1%22%2C%0A%20%20%20%20%22ALLOWED_VERSIONS%22%3A%20%5B%22v1%22%2C%20%22v2%22%5D%2C%0A%20%20%20%20%22VERSION_PARAM%22%3A%20%22version%22%0A%7D%0A%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204655%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115204655.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115204737%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115204737.png)%0A%0A%0A%23%20%E4%B8%80%E8%88%AC%E4%BC%9A%E5%9C%A8URL%E4%BC%A0%E5%8F%82(%E6%8E%A8%E8%8D%90)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223441%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221223441.png)%0A%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223726%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221223726.png)%0A%0A-%20%E4%BF%AE%E6%94%B9url%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221223835%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221223835.png)%0A%0A%0A-%20%E5%86%99%E8%BF%9B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%0A%0A%0A%0A%0A%23%20%E6%BA%90%E7%A0%81%E6%B5%81%E7%A8%8B%0A%0A-%20dispatch%E6%96%B9%E6%B3%95%E9%87%8C%E9%9D%A2%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205114%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115205114.png)%0A%0A-%20%E8%B0%83%E7%94%A8%E4%BA%86determine_version%E6%96%B9%E6%B3%95%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205159%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115205159.png)%0A%0A%0A%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205246%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115205246.png)%0A%0A%60%60%60python%0A%20%20%20%20def%20determine_version(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20If%20versioning%20is%20being%20used%2C%20then%20determine%20any%20API%20version%20for%20the%0A%20%20%20%20%20%20%20%20incoming%20request.%20Returns%20a%20two-tuple%20of%20(version%2C%20versioning_scheme)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20if%20self.versioning_class%20is%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20(None%2C%20None)%0A%20%20%20%20%20%20%20%20%23%20%E5%A4%84%E7%90%86%E7%89%88%E6%9C%AC%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%3AURLPathVersioning%E5%AF%B9%E8%B1%A1%0A%20%20%20%20%20%20%20%20scheme%20%3D%20self.versioning_class()%0A%20%20%20%20%20%20%20%20%23%20%20%E8%AF%A5%E5%85%83%E7%BB%84%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E8%BF%94%E5%9B%9E%E8%BF%99%E4%B8%AA%E5%AF%B9%E8%B1%A1%E7%9A%84determine_version%E6%96%B9%E6%B3%95%20%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E8%BF%94%E5%9B%9Escheme%0A%20%20%20%20%20%20%20%20return%20(scheme.determine_version(request%2C%20*args%2C%20**kwargs)%2C%20scheme)%0A%60%60%60%0A%0A%0A-%20%E8%BF%94%E5%9B%9E%E7%89%88%E6%9C%AC%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225139%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221225139.png)%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225305%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221225305.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115205636%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115205636.png)%0A%0A%0A%23%20%E5%8F%8D%E5%90%91%E7%94%9F%E6%88%90URL%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221225904%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221225904.png)%0A%0A-%20%E5%A2%9E%E5%8A%A0%E4%B8%80%E4%B8%AAname%E5%8F%82%E6%95%B0%20%0A%60%60%60python%0A%20%20url(r'%5E(%3FP%3Cversion%3E%5Bv1%7Cv2%5D%2B)%2Fusers%2F'%2C%20views.UsersView.as_view()%2Cname%3D'user')%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190115211352%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190115211352.png)%0A%0A-%20%E4%B8%BA%E4%BB%80%E4%B9%88DRF%E7%9A%84reverse%E5%B8%A6%E7%89%88%E6%9C%AC%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190221230802%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190221230802.png)%0A%0A</center></body></html>