<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.0.5 (458014)"/><meta name="altitude" content="37.39571762084961"/><meta name="author" content="李居豪"/><meta name="created" content="2019-04-23 02:18:40 +0000"/><meta name="latitude" content="39.62996778867593"/><meta name="longitude" content="116.0482155605452"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-05-04 06:12:52 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>DRF进阶03</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">rest framework-用户登陆</h1>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">设计模型类</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.db <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> models


<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># Create your models here.</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UserInfo</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""用户表"""</span>
    user_type_choices = (
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'普通用户'</span>),
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'VIP'</span>),
        (<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">3</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'SVIP'</span>)
    )
    user_type = models.IntegerField(choices=user_type_choices)
    username = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">32</span>, unique=<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">True</span>)
    password = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">256</span>)


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">UserToken</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(models.Model)</span>:</span>
    user = models.OneToOneField(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'UserInfo'</span>)
    token = models.CharField(max_length=<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">256</span>)
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">随意添加几个用户</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106172135.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">编写URL</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106172443.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">编写视图</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> django.http <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> JsonResponse
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> rest_framework.views <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> APIView
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">from</span> myapp.models <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> UserInfo, UserToken


<span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">md5</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(user)</span>:</span>
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> hashlib
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">import</span> time

    ctime = str(time.time())
    m = hashlib.md5(bytes(user, encoding=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'utf-8'</span>))
    m.update(bytes(ctime, encoding=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'utf-8'</span>))
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> m.hexdigest()


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">AuthView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">post</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        ret = {<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'state_code'</span>: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1000</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'msg'</span>: <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>}
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">try</span>:
            user = request._request.POST.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'username'</span>)
            pwd = request._request.POST.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'password'</span>)
            obj = UserInfo.objects.filter(username=user, password=pwd).first()
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> obj:
                ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'state_code'</span>] = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1001</span>
                ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'msg'</span>] = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'用户名或者密码错误'</span>
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 为登陆用户创建token</span>
            token = md5(user)
            <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 存在就更新,不存在就创建</span>
            UserToken.objects.update_or_create(user=obj, defaults={<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'token'</span>: token})
            ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'token'</span>] = token
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">except</span> Exception <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">as</span> e:
            ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'state_code'</span>] = <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1002</span>
            ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'msg'</span>] = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'请求异常'</span>

        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse(ret)

</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106180131.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">postman</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106175612.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106175840.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">rest framework-基于token实现基本用户认证</h1>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">问题1:有些API需要用户登陆成功之后,才能访问；有些无需登陆就能访问</p>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">解决:这时候我们就可以使用认证</p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">1.创建两张表</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">2.用户登陆(返回token并保存到数据库)</li>
</ul>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">
<p style="line-height: 160%; box-sizing: content-box; color: #333; margin: 0;">编写一个伪订单,假设只有用过认证以后的用户才能查看该订单</p>
</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 伪订单(字典)</span>
ORDER_DICT = {
    <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>: {
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"name"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"娃娃"</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"size"</span>: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">18</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"gender"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"男"</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"content"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"...."</span>
    },
    <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">2</span>: {
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"name"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"娃娃2"</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"size"</span>: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">28</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"gender"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"男"</span>,
        <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"content"</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"...."</span>
    },

}
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">编写一个基于APIView的视图</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 只用用户发起请求立马就能拿到所有订单</span>
<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">OrderView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""
    订单相关业务
    """</span>

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        ret = {<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'state_code'</span>: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1000</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"msg"</span>: <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"data"</span>: <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">None</span>}
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">try</span>:
            ret[<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'data'</span>] = ORDER_DICT
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">except</span> Exception <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">as</span> e:
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">pass</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> JsonResponse(ret)
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210057.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">需求:只有登陆过得用户才能看到</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">OrderView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""
    订单相关业务
    """</span>

    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">get</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request, *args, **kwargs)</span>:</span>
        token = request._request.GET.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">'token'</span>)
        ...
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210553.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">我们可以自己去写一个认证类</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210807.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">MyAuthtication</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(BaseAuthentication)</span>:</span>
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">def</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">authenticate</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(self, request)</span>:</span>
        token = request._request.GET.get(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"token"</span>)
        token_obj = UserToken.objects.filter(token=token).first()
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">not</span> token_obj:
            <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">raise</span> AuthenticationFailed(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"用户认证失败"</span>)
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 在rest framework内部会将这两个字段赋值给request,以供我们后续操作使用</span>
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> (token_obj.user, token_obj)


<span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">OrderView</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(APIView)</span>:</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"""
    订单相关业务
    """</span>
    authentication_classes = [MyAuthtication]

    ...
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109211724.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">postman验证(不带token)</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109212031.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">postman(带token)</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109212316.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">rest_framework-匿名用户配置</h1>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">全局认证设置</h2>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># APIView里面的类属性</span>
authentication_classes = api_settings.DEFAULT_AUTHENTICATION_CLASSES
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109224623.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109224741.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">我们可以把我们的写的代码放到一个模块里面</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109225144.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># django的settings文件</span>
REST_FRAMEWORK = {
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 全局</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"DEFAULT_AUTHENTICATION_CLASSES"</span>: [<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"myutils.auth.MyAuthtication"</span>,]
}


</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109225536.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">设置一个匿名用户</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">REST_FRAMEWORK = {
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;"># 全局</span>
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"DEFAULT_AUTHENTICATION_CLASSES"</span>: [<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"myutils.auth.MyBaseAuthtication"</span>, ],
    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"UNAUTHENTICATED_USER"</span>: <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">lambda</span>: <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"匿名用户"</span>
}
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190110093330.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000;">内置基本认证</h1>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220143802.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220143933.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150038.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150228.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">修改源代码</li>
</ul>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="http://md.100cxy.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150717.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">以后我们自己写认证类的时候,必须继承自 BaseAuthentication</li>
</ul>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20rest%20framework-%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%0A%0A-%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9E%8B%E7%B1%BB%20%0A%0A%60%60%60python%20%0Afrom%20django.db%20import%20models%0A%0A%0A%23%20Create%20your%20models%20here.%0Aclass%20UserInfo(models.Model)%3A%0A%20%20%20%20%22%22%22%E7%94%A8%E6%88%B7%E8%A1%A8%22%22%22%0A%20%20%20%20user_type_choices%20%3D%20(%0A%20%20%20%20%20%20%20%20(1%2C%20'%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7')%2C%0A%20%20%20%20%20%20%20%20(2%2C%20'VIP')%2C%0A%20%20%20%20%20%20%20%20(3%2C%20'SVIP')%0A%20%20%20%20)%0A%20%20%20%20user_type%20%3D%20models.IntegerField(choices%3Duser_type_choices)%0A%20%20%20%20username%20%3D%20models.CharField(max_length%3D32%2C%20unique%3DTrue)%0A%20%20%20%20password%20%3D%20models.CharField(max_length%3D256)%0A%0A%0Aclass%20UserToken(models.Model)%3A%0A%20%20%20%20user%20%3D%20models.OneToOneField('UserInfo')%0A%20%20%20%20token%20%3D%20models.CharField(max_length%3D256)%0A%60%60%60%0A%0A-%20%E9%9A%8F%E6%84%8F%E6%B7%BB%E5%8A%A0%E5%87%A0%E4%B8%AA%E7%94%A8%E6%88%B7%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106172135%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190106172135.png)%0A%0A%0A-%20%E7%BC%96%E5%86%99URL%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106172443%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190106172443.png)%0A%0A-%20%E7%BC%96%E5%86%99%E8%A7%86%E5%9B%BE%0A%0A%60%60%60python%0Afrom%20django.http%20import%20JsonResponse%0Afrom%20rest_framework.views%20import%20APIView%0Afrom%20myapp.models%20import%20UserInfo%2C%20UserToken%0A%0A%0Adef%20md5(user)%3A%0A%20%20%20%20import%20hashlib%0A%20%20%20%20import%20time%0A%0A%20%20%20%20ctime%20%3D%20str(time.time())%0A%20%20%20%20m%20%3D%20hashlib.md5(bytes(user%2C%20encoding%3D'utf-8'))%0A%20%20%20%20m.update(bytes(ctime%2C%20encoding%3D'utf-8'))%0A%20%20%20%20return%20m.hexdigest()%0A%0A%0Aclass%20AuthView(APIView)%3A%0A%20%20%20%20def%20post(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20ret%20%3D%20%7B'state_code'%3A%201000%2C%20'msg'%3A%20None%7D%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20user%20%3D%20request._request.POST.get('username')%0A%20%20%20%20%20%20%20%20%20%20%20%20pwd%20%3D%20request._request.POST.get('password')%0A%20%20%20%20%20%20%20%20%20%20%20%20obj%20%3D%20UserInfo.objects.filter(username%3Duser%2C%20password%3Dpwd).first()%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20not%20obj%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'state_code'%5D%20%3D%201001%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'msg'%5D%20%3D%20'%E7%94%A8%E6%88%B7%E5%90%8D%E6%88%96%E8%80%85%E5%AF%86%E7%A0%81%E9%94%99%E8%AF%AF'%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E4%B8%BA%E7%99%BB%E9%99%86%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BAtoken%0A%20%20%20%20%20%20%20%20%20%20%20%20token%20%3D%20md5(user)%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20%E5%AD%98%E5%9C%A8%E5%B0%B1%E6%9B%B4%E6%96%B0%2C%E4%B8%8D%E5%AD%98%E5%9C%A8%E5%B0%B1%E5%88%9B%E5%BB%BA%0A%20%20%20%20%20%20%20%20%20%20%20%20UserToken.objects.update_or_create(user%3Dobj%2C%20defaults%3D%7B'token'%3A%20token%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'token'%5D%20%3D%20token%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'state_code'%5D%20%3D%201002%0A%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'msg'%5D%20%3D%20'%E8%AF%B7%E6%B1%82%E5%BC%82%E5%B8%B8'%0A%0A%20%20%20%20%20%20%20%20return%20JsonResponse(ret)%0A%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106180131%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190106180131.png)%0A%0A-%20postman%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106175612%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190106175612.png)%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190106175840%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190106175840.png)%0A%0A%23%20rest%20framework-%E5%9F%BA%E4%BA%8Etoken%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%20%0A-%20%E9%97%AE%E9%A2%981%3A%E6%9C%89%E4%BA%9BAPI%E9%9C%80%E8%A6%81%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86%E6%88%90%E5%8A%9F%E4%B9%8B%E5%90%8E%2C%E6%89%8D%E8%83%BD%E8%AE%BF%E9%97%AE%EF%BC%9B%E6%9C%89%E4%BA%9B%E6%97%A0%E9%9C%80%E7%99%BB%E9%99%86%E5%B0%B1%E8%83%BD%E8%AE%BF%E9%97%AE%20%20%0A-%20%E8%A7%A3%E5%86%B3%3A%E8%BF%99%E6%97%B6%E5%80%99%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%AE%A4%E8%AF%81%20%20%0A%20%20%20%20-%201.%E5%88%9B%E5%BB%BA%E4%B8%A4%E5%BC%A0%E8%A1%A8%20%0A%20%20%20%20-%202.%E7%94%A8%E6%88%B7%E7%99%BB%E9%99%86(%E8%BF%94%E5%9B%9Etoken%E5%B9%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93)%0A%0A-%20%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E4%BC%AA%E8%AE%A2%E5%8D%95%2C%E5%81%87%E8%AE%BE%E5%8F%AA%E6%9C%89%E7%94%A8%E8%BF%87%E8%AE%A4%E8%AF%81%E4%BB%A5%E5%90%8E%E7%9A%84%E7%94%A8%E6%88%B7%E6%89%8D%E8%83%BD%E6%9F%A5%E7%9C%8B%E8%AF%A5%E8%AE%A2%E5%8D%95%0A%60%60%60python%0A%23%20%E4%BC%AA%E8%AE%A2%E5%8D%95(%E5%AD%97%E5%85%B8)%0AORDER_DICT%20%3D%20%7B%0A%20%20%20%201%3A%20%7B%0A%20%20%20%20%20%20%20%20%22name%22%3A%20%22%E5%A8%83%E5%A8%83%22%2C%0A%20%20%20%20%20%20%20%20%22size%22%3A%2018%2C%0A%20%20%20%20%20%20%20%20%22gender%22%3A%20%22%E7%94%B7%22%2C%0A%20%20%20%20%20%20%20%20%22content%22%3A%20%22....%22%0A%20%20%20%20%7D%2C%0A%20%20%20%202%3A%20%7B%0A%20%20%20%20%20%20%20%20%22name%22%3A%20%22%E5%A8%83%E5%A8%832%22%2C%0A%20%20%20%20%20%20%20%20%22size%22%3A%2028%2C%0A%20%20%20%20%20%20%20%20%22gender%22%3A%20%22%E7%94%B7%22%2C%0A%20%20%20%20%20%20%20%20%22content%22%3A%20%22....%22%0A%20%20%20%20%7D%2C%0A%0A%7D%0A%60%60%60%0A-%20%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8EAPIView%E7%9A%84%E8%A7%86%E5%9B%BE%0A%60%60%60python%0A%23%20%E5%8F%AA%E7%94%A8%E7%94%A8%E6%88%B7%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82%E7%AB%8B%E9%A9%AC%E5%B0%B1%E8%83%BD%E6%8B%BF%E5%88%B0%E6%89%80%E6%9C%89%E8%AE%A2%E5%8D%95%0Aclass%20OrderView(APIView)%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20%E8%AE%A2%E5%8D%95%E7%9B%B8%E5%85%B3%E4%B8%9A%E5%8A%A1%0A%20%20%20%20%22%22%22%0A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20ret%20%3D%20%7B'state_code'%3A%201000%2C%20%22msg%22%3A%20None%2C%20%22data%22%3A%20None%7D%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20ret%5B'data'%5D%20%3D%20ORDER_DICT%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20pass%0A%20%20%20%20%20%20%20%20return%20JsonResponse(ret)%0A%60%60%60%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210057%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109210057.png)%0A%0A-%20%E9%9C%80%E6%B1%82%3A%E5%8F%AA%E6%9C%89%E7%99%BB%E9%99%86%E8%BF%87%E5%BE%97%E7%94%A8%E6%88%B7%E6%89%8D%E8%83%BD%E7%9C%8B%E5%88%B0%20%20%0A%60%60%60python%0Aclass%20OrderView(APIView)%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20%E8%AE%A2%E5%8D%95%E7%9B%B8%E5%85%B3%E4%B8%9A%E5%8A%A1%0A%20%20%20%20%22%22%22%0A%0A%20%20%20%20def%20get(self%2C%20request%2C%20*args%2C%20**kwargs)%3A%0A%20%20%20%20%20%20%20%20token%20%3D%20request._request.GET.get('token')%0A%20%20%20%20%20%20%20%20...%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210553%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109210553.png)%0A%0A-%20%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%B7%B1%E5%8E%BB%E5%86%99%E4%B8%80%E4%B8%AA%E8%AE%A4%E8%AF%81%E7%B1%BB%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109210807%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109210807.png)%0A%0A%60%60%60python%0Aclass%20MyAuthtication(BaseAuthentication)%3A%0A%20%20%20%20def%20authenticate(self%2C%20request)%3A%0A%20%20%20%20%20%20%20%20token%20%3D%20request._request.GET.get(%22token%22)%0A%20%20%20%20%20%20%20%20token_obj%20%3D%20UserToken.objects.filter(token%3Dtoken).first()%0A%20%20%20%20%20%20%20%20if%20not%20token_obj%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20raise%20AuthenticationFailed(%22%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E5%A4%B1%E8%B4%A5%22)%0A%20%20%20%20%20%20%20%20%23%20%E5%9C%A8rest%20framework%E5%86%85%E9%83%A8%E4%BC%9A%E5%B0%86%E8%BF%99%E4%B8%A4%E4%B8%AA%E5%AD%97%E6%AE%B5%E8%B5%8B%E5%80%BC%E7%BB%99request%2C%E4%BB%A5%E4%BE%9B%E6%88%91%E4%BB%AC%E5%90%8E%E7%BB%AD%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8%0A%20%20%20%20%20%20%20%20return%20(token_obj.user%2C%20token_obj)%0A%0A%0Aclass%20OrderView(APIView)%3A%0A%20%20%20%20%22%22%22%0A%20%20%20%20%E8%AE%A2%E5%8D%95%E7%9B%B8%E5%85%B3%E4%B8%9A%E5%8A%A1%0A%20%20%20%20%22%22%22%0A%20%20%20%20authentication_classes%20%3D%20%5BMyAuthtication%5D%0A%0A%20%20%20%20...%0A%60%60%60%0A%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109211724%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109211724.png)%0A%0A-%20postman%E9%AA%8C%E8%AF%81(%E4%B8%8D%E5%B8%A6token)%20%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109212031%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109212031.png)%0A%0A-%20postman(%E5%B8%A6token)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109212316%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109212316.png)%0A%0A%23%20rest_framework-%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%20%0A%23%23%20%E5%85%A8%E5%B1%80%E8%AE%A4%E8%AF%81%E8%AE%BE%E7%BD%AE%0A%60%60%60python%0A%23%20APIView%E9%87%8C%E9%9D%A2%E7%9A%84%E7%B1%BB%E5%B1%9E%E6%80%A7%0Aauthentication_classes%20%3D%20api_settings.DEFAULT_AUTHENTICATION_CLASSES%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109224623%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109224623.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109224741%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109224741.png)%0A%0A-%20%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8A%8A%E6%88%91%E4%BB%AC%E7%9A%84%E5%86%99%E7%9A%84%E4%BB%A3%E7%A0%81%E6%94%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97%E9%87%8C%E9%9D%A2%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109225144%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109225144.png)%0A%0A%60%60%60python%0A%23%20django%E7%9A%84settings%E6%96%87%E4%BB%B6%0AREST_FRAMEWORK%20%3D%20%7B%0A%20%20%20%20%23%20%E5%85%A8%E5%B1%80%0A%20%20%20%20%22DEFAULT_AUTHENTICATION_CLASSES%22%3A%20%5B%22myutils.auth.MyAuthtication%22%2C%5D%0A%7D%0A%0A%0A%60%60%60%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190109225536%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190109225536.png)%0A%0A-%20%E8%AE%BE%E7%BD%AE%E4%B8%80%E4%B8%AA%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7%20%0A%60%60%60python%0AREST_FRAMEWORK%20%3D%20%7B%0A%20%20%20%20%23%20%E5%85%A8%E5%B1%80%0A%20%20%20%20%22DEFAULT_AUTHENTICATION_CLASSES%22%3A%20%5B%22myutils.auth.MyBaseAuthtication%22%2C%20%5D%2C%0A%20%20%20%20%22UNAUTHENTICATED_USER%22%3A%20lambda%3A%20%22%E5%8C%BF%E5%90%8D%E7%94%A8%E6%88%B7%22%0A%7D%0A%60%60%60%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190110093330%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190110093330.png)%0A%0A%23%20%E5%86%85%E7%BD%AE%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220143802%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190220143802.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220143933%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190220143933.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150038%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190220150038.png)%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150228%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190220150228.png)%0A%0A-%20%E4%BF%AE%E6%94%B9%E6%BA%90%E4%BB%A3%E7%A0%81%0A%0A!%5B%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190220150717%5D(http%3A%2F%2Fmd.100cxy.com%2F%25E5%25BE%25AE%25E4%25BF%25A1%25E6%2588%25AA%25E5%259B%25BE_20190220150717.png)%0A%0A-%20%E4%BB%A5%E5%90%8E%E6%88%91%E4%BB%AC%E8%87%AA%E5%B7%B1%E5%86%99%E8%AE%A4%E8%AF%81%E7%B1%BB%E7%9A%84%E6%97%B6%E5%80%99%2C%E5%BF%85%E9%A1%BB%E7%BB%A7%E6%89%BF%E8%87%AA%20BaseAuthentication%0A%0A%0A</center></body></html>