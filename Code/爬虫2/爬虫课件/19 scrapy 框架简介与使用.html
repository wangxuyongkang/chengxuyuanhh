<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.0.5 (458014)"/><meta name="altitude" content="36"/><meta name="author" content="李居豪"/><meta name="created" content="2019-05-29 05:26:20 +0000"/><meta name="latitude" content="39.63160386470755"/><meta name="longitude" content="116.0505396072704"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-06-29 07:40:23 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>19 scrapy 框架简介与使用</title></head><body><div><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/5c1785d6902b7.png" height="379" width="1047"/></span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/5c1785d6902b7.png" height="379" width="1047"/></span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/5c1785d6902b7.png" height="379" width="1047"/></span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img/></span></div></div><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">Scrapy 框架</span></h2><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">Scrapy是用纯Python实现一个为了爬取网站数据、提取结构性数据而编写的应用框架，用途非常广泛。</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">框架的力量，用户只需要定制开发几个模块就可以轻松的实现一个爬虫，用来抓取网页内容以及各种图片，非常之方便。</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">Scrapy 使用了 Twisted['twɪstɪd] 异步网络框架来处理网络通讯，可以加快我们的下载速度，不用自己去实现异步框架，并且包含了各种中间件接口，可以灵活的完成各种需求。</span></div></li></ul><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;">同步异步</span></h2><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="https://i.loli.net/2018/12/17/5c1785d6902b7.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">异步：调用在发出之后，这个调用就直接返回，不管有无结果</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">非阻塞：关注的是程序在等待调用结果（消息，返回值）时的状态，指在不能立刻得到结果之前，该调用不会阻塞当前线程</span></div></li></ul><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">Scrapy架构图(绿线是数据流向)</span></h2><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="https://i.loli.net/2018/12/17/5c17862075585.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Scrapy Engine(引擎)</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">: 负责Spider、ItemPipeline、Downloader、Scheduler中间的通讯，信号、数据传递等。</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Scheduler(调度器)</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">: 它负责接受引擎发送过来的Request请求，并按照一定的方式进行整理排列，入队，当引擎需要时，交还给引擎。</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Downloader（下载器）</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：负责下载Scrapy Engine(引擎)发送的所有Requests请求，并将其获取到的Responses交还给Scrapy Engine(引擎)，由引擎交给Spider来处理，</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Spider（爬虫）</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：它负责处理所有Responses,从中分析提取数据，获取Item字段需要的数据，并将需要跟进的URL提交给引擎，再次进入Scheduler(调度器)，</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Item Pipeline(管道)</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：它负责处理Spider中获取到的Item，并进行进行后期处理（详细分析、过滤、存储等）的地方.</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Downloader Middlewares</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">（下载中间件）：可以自定义扩展下载功能的组件（代理、cokies等）。</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Spider Middlewares</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">（Spider中间件）：可以自定扩展和操作引擎和Spider中间通信的功能组件（比如进入Spider的Responses;和从Spider出去的Requests）</span></div></li></ul><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="https://i.loli.net/2018/12/17/5c17863914b96.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">注意！只有当调度器中不存在任何request了，整个程序才会停止，（也就是说，对于下载失败的URL，Scrapy也会重新下载。）</span></div></div><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">Scrapy的安装介绍</span></h2><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">Scrapy框架官方网址：http://doc.scrapy.org/en/latest</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">Scrapy中文维护站点：http://scrapy-chs.readthedocs.io/zh_CN/latest/index.html</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Windows 安装方式</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">Python 3</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">升级pip版本：</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">pip3 install --upgrade pip</span></div></blockquote><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">通过pip 安装 Scrapy 框架</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">pip3 install Scrapy</span></div></blockquote><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Ubuntu 安装方式</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">通过pip3 安装 Scrapy 框架</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">sudo pip3 install scrapy</span></div></blockquote><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">如果安装不成功再试着添加这些依赖库</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">安装非Python的依赖</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">sudo apt-get install python3-dev python-pip libxml2-dev libxslt1-dev zlib1g-dev libffi-dev libssl-dev</span></div></blockquote><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">安装后，只要在命令终端输入 scrapy，提示类似以下结果，代表已经安装成功</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="https://i.loli.net/2018/10/29/5bd6f1c48598d.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></span></div><hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;">scrapy 入门案例和项目目录说明</span></h2><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">学习目标</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">创建一个Scrapy项目</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">定义提取的结构化数据(Item)</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">编写爬取网站的 Spider 并提取出结构化数据(Item)</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">编写 Item Pipelines 来存储提取到的Item(即结构化数据)</span></div></li></ul><h3 style="box-sizing: content-box; font-size: 27px;"><span style="font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;">一. 新建项目(scrapy startproject)</span></h3><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">在开始爬取之前，必须创建一个新的Scrapy项目。进入自定义的项目目录中，运行下列命令：</span></div><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">scrapy startproject 爬虫项目名称</span></div></blockquote><h3 style="box-sizing: content-box; font-size: 27px;"><span style="font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">案例一（jobbole）</span></h3><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">新建项目(scrapy startproject)</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">在开始爬取之前，必须创建一个新的Scrapy项目。进入自定义的项目目录中，运行下列命令：</span></div></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">创建爬虫项目</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">scrapy startproject jobboleproject</span></div></blockquote><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="https://i.loli.net/2018/10/29/5bd69464121da.png" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">新建爬虫文件</span></div></li></ul><blockquote style="box-sizing: content-box; margin: 15px 0px; border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">scrapy genspider jobbole jobbole.com</span></div></blockquote><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/85D52837-544E-438C-B573-D60722B93F60.png" height="140" width="643"/></span></div><h3 style="box-sizing: content-box; font-size: 27px;"><span style="font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">流程如下:个人思路不同写代码的先后顺序可能有所差异</span></h3><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">目标网址:</span> <span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">http://blog.jobbole.com/all-posts/</span></div></li><li style="box-sizing: content-box; position: relative;"><div style="box-sizing: content-box; margin: 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">需求</span> <span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">获取jobbole网站中的所有文章信息。</span></div></li></ul><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">根据目标网站分析需要提取的数据，在item.py文件中添加字段</span></h4><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">打开jobboleproject文件下的item.py文件</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">item 定义结构化数据字段，用来保存爬取到的数据，有点像Python中的dict，但是提供了一些额外的保护减少错误</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">。</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">可以通过创建一个 scrapy.Item 类， 并且定义类型为 scrapy.Field的类属性来定义一个Item（可以理解成类似于ORM的映射关系）</span></div></li></ul><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">（jobboleproject/item.py）文件</span></h4><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class JobboleItem(scrapy.Item):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># define the fields for your item here like:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#标题</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">title = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#创建时间</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">create_date = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章地址</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">url = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#id</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">url_object_id = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章图片</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">front_image_url = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章图片地址</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">front_image_path = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 点赞数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">praise_nums = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#收藏数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">bookmark_nums = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 评论数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">comment_nums = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章内容</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">content = scrapy.Field()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#标签</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">tags = scrapy.Field()</span></div></div></div><h3 style="box-sizing: content-box; font-size: 27px;"><span style="font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">制作爬虫 （jobboleproject/spiders/jobbole.py）</span></h3><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">打开 jobboleproject/spider目录里的 jobbole.py，默认增加了下列代码:</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">jobbole.py</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># -*- coding: utf-8 -*-</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">import scrapy</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class JobboleSpider(scrapy.Spider):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">name = 'jobbole'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">allowed_domains = ['jobbole.com']</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">start_urls = ['http://blog.jobbole.com/all-posts/']</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def parse(self, response):</span></div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">pass</span></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">其实也可以由我们自行创建jobbole.py并编写上面的代码，只不过使用命令可以免去编写固定代码的麻烦</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">要建立一个Spider， 你必须用scrapy.Spider类创建一个子类，并确定了三个强制的属性 和 一个方法。</span></div></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">name = "" ：这个爬虫的识别名称，必须是唯一的，在不同的爬虫必须定义不同的名字</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">。</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">allow_domains = [] 是搜索的域名范围，也就是爬虫的约束区域，规定爬虫只爬取这个域名下的网页，不存在的URL会被忽略</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">。</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">start_urls = () ：爬取的URL元祖/列表。爬虫从这里开始抓取数据，所以，第一次下载的数据将会从这些urls开始。其他子URL将会从这些起始URL中继承性生成</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">。</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">parse(self, response) ：解析的方法，每个初始URL完成下载后将被调用，调用的时候传入从每一个URL传回的Response对象来作为唯一参数</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">，主要作用如下：</span></div></li><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 0px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">负责解析返回的网页数据(response.body)，提取结构化数据(生成item)</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">生成需要下一页的URL请求。</span></div></li></ul></ul><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">将start_urls(设置起始url)的值修改为需要爬取的第一个url</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">start_urls = ("http://blog.jobbole.com/all-posts/",)</span></div></div><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">分析网站结构取数据</span></h4><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">爬取整个网页完毕，接下来的就是的取过程了，首先观察页面源码：</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">我们本次案例分为两步来走</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">step1:</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">获取列表页面的所有文章的图片链接和详情地址</span></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/0598A95A-74C6-489C-9C33-15F260BC1F01.png" height="268" width="476"/></span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/7E0DF02A-00FC-4EE9-89A0-4CFDD7B3963E.png" height="332" width="597"/></span></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">step2:</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">获取到文章的链接list和图片list之后我们，通过文章的链接获取文章详情里面的内容，这里</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">列举部分，其它的自行查看</span></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;"><img src="19%20scrapy%20%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8.resources/4E13DB5C-C50B-43B5-82EF-2280B44360C5.png" height="109" width="555"/></span></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">是不是一目了然？直接上XPath开始提取数据吧。</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">我们之前在jobboleproject/items.py 里定义了一个</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">JobboleprojectItem 类。 这里引入进来</span></div></div><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">在parse方法中做数据的提取</span></h4><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">from jobboleproject.items import JobboleprojectItem</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">1.获取图片和文章详情的链接</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def parse(self, response):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># css选择器获取当前列表页面的所有的节点</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">post_nodes = response.css("#archive .floated-thumb .post-thumb a")</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 如果不是完整的域名 需要拼接完整 response.url + post_url</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 获取到的URL可能不是一个域名，也可能是具体的文章需要使用parse函数from urllib import parse</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">for post_node in post_nodes:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">image_url = post_node.css("img::attr(src)").extract_first("")</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">post_url = post_node.css("::attr(href)").extract_first("")</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">full_url = response.urljoin(post_url)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#meta参数对应的是一个字典，用来传递数据</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">yield scrapy.Request(url=full_url, meta={"front_image_url": image_url},</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">callback=self.parse_detail)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">2.然后将我们得到的数据封装到一个 JobboleItem 对象中，可以保存每个文章的属性：</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def parse_detail(self,response):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># print(response)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 使用xpath语法或者css语法提取网页的相关信息</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># extract（） 串行化并将匹配到的节点返回一个unicode字符串列表</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item = JobboleprojectItem()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#标题</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['title'] = response.xpath('//div[@]/h1/text()').extract_frist("")</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#发布日期</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['create_date'] = response.xpath("//p[@]/text()").extract_first("").strip().replace("·","").strip()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章地址详情地址</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['url'] = response.url</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># http://blog.jobbole.com/113949/</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#文章的id</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['url_object_id'] = re.match(".*?(\d+).*", url).group(1)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 文章图片</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['front_image_url'] = response.meta.get("front_image_url","")</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 点赞数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['praise_nums'] = response.xpath("//span[contains(@class,'vote-post-up')]/h10/text()").extract_first("")</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 收藏数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">bookmark_nums = response.xpath("//span[contains(@class,'bookmark-btn')]/text()").extract_first("")</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">match_bookmark_nums = re.match(".*?(\d+).*",bookmark_nums)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">if match_bookmark_nums:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['bookmark_nums'] = int(match_bookmark_nums.group(1))</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">else:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['bookmark_nums'] = 0</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 评论数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">comment_nums = response.xpath("//a[@href='#article-comment']/span/text()").extract_first("")</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">match_comment_nums = re.match(".*?(\d+).*",comment_nums)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">if match_comment_nums:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['comment_nums'] = int(match_comment_nums.group(1))</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">else:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['comment_nums'] = 0</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 文章内容</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['content'] = response.xpath("//div[@]").extract_first("")</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 过滤评论标签</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">tag_list = response.xpath("//p[@]//a/text()").extract()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">tag_list = [element for element in tag_list if not element.strip().endswith("评论")]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 标签</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item['tags'] = ",".join(tag_list)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">print(item)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># yield将获取的数据交给pipelines</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">yield item</span></div></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">关于yeild函数介绍</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">参考资料说明：https://blog.csdn.net/u013205877/article/details/70332612</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">https://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/</span></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">简单地讲，</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">yield 的作用就是把一个函数变成一个 generator（生成器），带有 yield 的函数不再是一个普通函数，Python 解释器会将其视为一个 generator</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">，带有yeild的函数遇到yeild的时候就返回一个迭代值，下次迭代时，</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">代码从 yield 的下一条语句继续执行，而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，</span></div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">直到再次遇到 yield。</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">通俗的讲就是：在一个函数中，程序执行到yield语句的时候，程序暂停，返回yield后面表达式的值，在下一次调用的时候，从yield语句暂停的地方继续执行，如此循环，直到函数执行完。</span></div><hr style="line-height: 160%; box-sizing: content-box; border-top: 1px solid #eee; margin: 16px 0;"/><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;">Scrapy Item pipeline(管道文件)使用</span></h2><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">Item Pipeline</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">当Item在Spider中被收集之后，它将会被传递到Item Pipeline，这些Item Pipeline组件按定义的顺序处理Item。</span></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">每个Item Pipeline都是实现了简单方法的Python类，比如决定此Item是丢弃而存储。以下是item pipeline的一些典型应用：</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">验证爬取的数据(检查item包含某些字段，比如说name字段)</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">查重(并丢弃)</span></div></li><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">将爬取结果保存到文件或者数据库中</span></div></li></ul><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">编写item pipeline</span></h4><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">编写item pipeline很简单，item pipiline组件是一个独立的Python类，其中process_item()方法必须实现:</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">import something</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class SomethingPipeline(object):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def __init__(self):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 可选实现，做参数初始化等</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># doing something</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def process_item(self, item, spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># item (Item 对象) – 被爬取的item</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># spider (Spider 对象) – 爬取该item的spider</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 这个方法必须实现，每个item pipeline组件都需要调用该方法，</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 这个方法必须返回一个 Item 对象，被丢弃的item将不会被之后的pipeline组件所处理。</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return item</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def open_spider(self, spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># spider (Spider 对象) – 被开启的spider</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 可选实现，当spider被开启时，这个方法被调用。</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def close_spider(self, spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># spider (Spider 对象) – 被关闭的spider</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 可选实现，当spider被关闭时，这个方法被调用</span></div><div><br/></div></div></div><h2 style="box-sizing: content-box; font-size: 34px; border-bottom: 1px solid rgb(219, 219, 219);"><span style="font-size: 34px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%;">数据持久化</span></h2><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">方式一：数据存入mongodb数据库</span></h4><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">settings.py文件</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">:</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">设置文件，在这里设置User-Agent,激活管道文件等．．．</span></div></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">ITEM_PIPELINES = {</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'douban.pipelines.DoubanPipeline': 300,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">}</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MONGODB_HOST = '127.0.0.1' #MONGODB 主机名</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MONGODB_PORT= 27017 #MONGODB 端口号</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MONGODB_DBNAME = "Douban" #数据库名称</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MONGODB_SHEETNAME= "doubanmovies" #存储数据的表名称</span></div></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">pipelines.py管道</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：这里进行数据的清洗和持久化</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">import pymongo</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">from scrapy.conf import settings</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class DoubanPipeline(object):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 将数据存储在mongodb中</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def __init__(self,host,port,dbname,sheetname):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 创建MONGODB数据库链接</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">client = pymongo.MongoClient(host=host, port=port)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 指定数据库</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">mydb = client[dbname]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 存放数据的集合名称</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.mysheet = mydb[sheetname]</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">@classmethod</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def from_crawler(cls, crawler):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">host = crawler.settings["MONGODB_HOST"]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">port = crawler.settings["MONGODB_PORT"]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">dbname = crawler.settings["MONGODB_DBNAME"]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">sheetname = crawler.settings["MONGODB_SHEETNAME"]</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return cls(host,port,dbname,sheetname)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def process_item(self,item,spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">data = dict(item)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># mongodb数据插入语句，使用save保存数据的效率会很慢，因为它需要循环便利，操作费时</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.mysheet.insert(data)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return item</span></div></div></div><h3 style="box-sizing: content-box; font-size: 27px;"><span style="font-size: 27px; color: rgb(51, 51, 51); font-weight: 700; line-height: 160%; box-sizing: content-box;">数据存入mysql数据库</span></h3><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">settings.py文件</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">:</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">设置文件，在这里设置User-Agent,激活管道文件等．．．</span></div></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">ITEM_PIPELINES = {</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'douban.pipelines.DoubanPipeline': 300,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">}</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#关于数据库的相关配置</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_HOST = '127.0.0.1'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_PORT = 3306</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_USER = '用户名'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_PWD = '密码'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_DB = '数据库'</span></div></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">pipelines.py管道文件</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">import pymysql</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class DoubanPipeline(object):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 将数据存储值mysql数据库</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># _mysql_exceptions.OperationalError: (1366, 是因为数据库中的字符集与charset="utf8"不符合</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def __init__(self,host,port,user,pwd,db,charset):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.client = pymysql.Connect(host,user,pwd,db,port,charset='utf8')</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.cursor = self.client.cursor()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">@classmethod</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def from_crawler(cls,crawler):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">host = crawler.settings['MYSQL_HOST']</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">port = crawler.settings['MYSQL_PORT']</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">user = crawler.settings['MYSQL_USER']</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">pwd = crawler.settings['MYSQL_PWD']</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">db = crawler.settings['MYSQL_DB']</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return cls(host,port,user,pwd,db,charset)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def process_item(self,item,spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">insert_sql = """</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">insert into 表名(title, playable, content, star, commentnum, inq)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">VALUES (%s, %s, %s, %s, %s, %s)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">"""</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">try:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.cursor.execute(insert_sql, (item['title'], item['content'], item['score'], item['info']))</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.client.commit()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">except Exception as err:</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">print(err)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.client.rollback()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return item</span></div></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">思考???</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">：</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">在pipeline中我们进行数据插入，</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">如何解耦</span><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">？</span></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">将sql语句和要插入的数据在item中定义一个方法返回,通过item调用，然后返回</span></div><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class XxxxItem(scrapy.Item):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#名称</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">title = scrapy.Field()</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def insert_data_to_db(self,dataDict):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">sql = """</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">INSERT INTO caipu (%s)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">VALUES (%s)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">""" % (','.join(dataDict.keys()),','.join(['%s']*len(dataDict)))</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">data = list(dataDict.values())</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return sql,data</span></div></div></div><h4 style="box-sizing: content-box; font-size: 20px;"><span style="font-size: 20px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">mysql数据异步插入</span></h4><div style="box-sizing: content-box; margin: 10px 0px;"><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">上面的代码是同步的方法将数据插入数据库，那么我们如何使用异步的方式插入呢？</span></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">settings.py配置文件</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">将mysql相关信息写在settings中</span></div></li></ul><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_HOST = '127.0.0.1'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_ROOT = '数据库用户名'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_PASSWORD = '数据库密码'</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">MYSQL_DBNAME = 'DouBan'</span></div></div></div><ul style="box-sizing: content-box; list-style-type: disc; padding-left: 30px; margin: 6px 0px 10px;"><li style="box-sizing: content-box; position: relative;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">异步插入数据库</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">pipeline管道中的相关代码</span></div></li></ul><div style="box-sizing: content-box; border: 0px; border-radius: 0px; margin: 2px 0px 8px; background-color: rgb(245, 247, 248);"><div style="overflow-x: auto; background: rgb(30, 30, 30); box-sizing: content-box; border: 0px; border-radius: 0px; letter-spacing: -0.3px; padding: 18px; white-space: pre-wrap;"><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">import pymysql</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#twisted是一个异步的网络框架，这里可以帮助我们</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">实现异步将数据插入数据库</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#adbapi里面的子线程会去执行数据库的阻塞操作，</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">当一个线程执行完毕之后，同时，原始线程能继续</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">进行正常的工作，服务其他请求。</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">from twisted.enterprise import adbapi</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#mysql数据异步插入</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">class DoubanPipeline(object):</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def __init__(self,dbpool):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.dbpool = dbpool</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#使用这个函数来应用settings配置文件。</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">@classmethod</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def from_crawler(cls, crawler):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">parmas = {</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'host':crawler.settings['MYSQL_HOST'],</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'user':crawler.settings['MYSQL_USER'],</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'passwd':crawler.settings['MYSQL_PASSWD'],</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'db':crawler.settings['MYSQL_DB'],</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'port':3306,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'charset':'utf8',</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">}</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># **表示字典，*tuple元组,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);"># 使用ConnectionPool，起始最后返回的是一个ThreadPool</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">dbpool = adbapi.ConnectionPool(</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">'pymysql',</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">**parmas</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">return cls(dbpool)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def process_item(self, item, spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#这里去调用任务分配的方法</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">query = self.dbpool.runInteraction(</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.insert_data_todb,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">spider</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#数据插入失败的回调</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">query.addErrback(</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.handle_error,</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">item</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">)</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#执行数据插入的函数</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def insert_data_todb(self,cursor,item,spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">insert_str,parmas = item.insertdata()</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">cursor.execute(insert_str,parmas)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">print('插入成功')</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def handle_error(self,failure,item):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">print(failure)</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">print('插入错误')</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">#在这里执行你想要的操作</span></div><div><br/></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">def close_spider(self, spider):</span></div><div><span style="font-size: 14px; line-height: 160%; color: rgb(244, 244, 244);">self.pool.close()</span></div><div><br/></div></div></div><div style="box-sizing: content-box; margin: 10px 0px;"><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%; font-weight: 700; box-sizing: content-box;">MySQL 解决批量插入数据去重问题(自学)</span></div><div><span style="font-size: 14px; color: rgb(51, 51, 51); line-height: 160%;">https://blog.csdn.net/zp_00000/article/details/81042589</span></div></div></div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">!%5Bdbd6e67c6edc6553b3b87e58878f64ea.png%5D(en-resource%3A%2F%2Fdatabase%2F5265%3A0)%0A!%5Bdbd6e67c6edc6553b3b87e58878f64ea.png%5D(en-resource%3A%2F%2Fdatabase%2F5265%3A1)%0A!%5Bdbd6e67c6edc6553b3b87e58878f64ea.png%5D(en-resource%3A%2F%2Fdatabase%2F5265%3A2)%0A!%5Bdbd6e67c6edc6553b3b87e58878f64ea.png%5D(en-resource%3A%2F%2Fdatabase%2F5265%3A3)%0A!%5B0d42b72f171debd59ff6124b5d215d47.png%5D(en-resource%3A%2F%2Fdatabase%2F3944%3A0)%0A%23%23%20**Scrapy%20%E6%A1%86%E6%9E%B6**%0A%0A-%20Scrapy%E6%98%AF%E7%94%A8%E7%BA%AFPython%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%B8%BA%E4%BA%86%E7%88%AC%E5%8F%96%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE%E3%80%81%E6%8F%90%E5%8F%96%E7%BB%93%E6%9E%84%E6%80%A7%E6%95%B0%E6%8D%AE%E8%80%8C%E7%BC%96%E5%86%99%E7%9A%84%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6%EF%BC%8C%E7%94%A8%E9%80%94%E9%9D%9E%E5%B8%B8%E5%B9%BF%E6%B3%9B%E3%80%82%0A%0A-%20%E6%A1%86%E6%9E%B6%E7%9A%84%E5%8A%9B%E9%87%8F%EF%BC%8C%E7%94%A8%E6%88%B7%E5%8F%AA%E9%9C%80%E8%A6%81%E5%AE%9A%E5%88%B6%E5%BC%80%E5%8F%91%E5%87%A0%E4%B8%AA%E6%A8%A1%E5%9D%97%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BD%BB%E6%9D%BE%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB%EF%BC%8C%E7%94%A8%E6%9D%A5%E6%8A%93%E5%8F%96%E7%BD%91%E9%A1%B5%E5%86%85%E5%AE%B9%E4%BB%A5%E5%8F%8A%E5%90%84%E7%A7%8D%E5%9B%BE%E7%89%87%EF%BC%8C%E9%9D%9E%E5%B8%B8%E4%B9%8B%E6%96%B9%E4%BE%BF%E3%80%82%0A%0A-%20Scrapy%20%E4%BD%BF%E7%94%A8%E4%BA%86%20Twisted%5B'tw%C9%AAst%C9%AAd%5D%20%E5%BC%82%E6%AD%A5%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6%E6%9D%A5%E5%A4%84%E7%90%86%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8A%A0%E5%BF%AB%E6%88%91%E4%BB%AC%E7%9A%84%E4%B8%8B%E8%BD%BD%E9%80%9F%E5%BA%A6%EF%BC%8C%E4%B8%8D%E7%94%A8%E8%87%AA%E5%B7%B1%E5%8E%BB%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%8C%85%E5%90%AB%E4%BA%86%E5%90%84%E7%A7%8D%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%81%B5%E6%B4%BB%E7%9A%84%E5%AE%8C%E6%88%90%E5%90%84%E7%A7%8D%E9%9C%80%E6%B1%82%E3%80%82%0A%0A%23%23%20%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%0A%0A!%5B%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%5D(https%3A%2F%2Fi.loli.net%2F2018%2F12%2F17%2F5c1785d6902b7.png)%0A%0A-%20**%E5%BC%82%E6%AD%A5%EF%BC%9A%E8%B0%83%E7%94%A8%E5%9C%A8%E5%8F%91%E5%87%BA%E4%B9%8B%E5%90%8E%EF%BC%8C%E8%BF%99%E4%B8%AA%E8%B0%83%E7%94%A8%E5%B0%B1%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%EF%BC%8C%E4%B8%8D%E7%AE%A1%E6%9C%89%E6%97%A0%E7%BB%93%E6%9E%9C**%0A-%20**%E9%9D%9E%E9%98%BB%E5%A1%9E%EF%BC%9A%E5%85%B3%E6%B3%A8%E7%9A%84%E6%98%AF%E7%A8%8B%E5%BA%8F%E5%9C%A8%E7%AD%89%E5%BE%85%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%9C%EF%BC%88%E6%B6%88%E6%81%AF%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%89%E6%97%B6%E7%9A%84%E7%8A%B6%E6%80%81%EF%BC%8C%E6%8C%87%E5%9C%A8%E4%B8%8D%E8%83%BD%E7%AB%8B%E5%88%BB%E5%BE%97%E5%88%B0%E7%BB%93%E6%9E%9C%E4%B9%8B%E5%89%8D%EF%BC%8C%E8%AF%A5%E8%B0%83%E7%94%A8%E4%B8%8D%E4%BC%9A%E9%98%BB%E5%A1%9E%E5%BD%93%E5%89%8D%E7%BA%BF%E7%A8%8B**%0A%0A%23%23%20**Scrapy%E6%9E%B6%E6%9E%84%E5%9B%BE(%E7%BB%BF%E7%BA%BF%E6%98%AF%E6%95%B0%E6%8D%AE%E6%B5%81%E5%90%91)**%0A%0A!%5Bscrapypricture%5D(https%3A%2F%2Fi.loli.net%2F2018%2F12%2F17%2F5c17862075585.png)%0A%0A-%20**Scrapy%20Engine(%E5%BC%95%E6%93%8E)**%3A%20%E8%B4%9F%E8%B4%A3Spider%E3%80%81ItemPipeline%E3%80%81Downloader%E3%80%81Scheduler%E4%B8%AD%E9%97%B4%E7%9A%84%E9%80%9A%E8%AE%AF%EF%BC%8C%E4%BF%A1%E5%8F%B7%E3%80%81%E6%95%B0%E6%8D%AE%E4%BC%A0%E9%80%92%E7%AD%89%E3%80%82%0A%0A-%20**Scheduler(%E8%B0%83%E5%BA%A6%E5%99%A8)**%3A%20%E5%AE%83%E8%B4%9F%E8%B4%A3%E6%8E%A5%E5%8F%97%E5%BC%95%E6%93%8E%E5%8F%91%E9%80%81%E8%BF%87%E6%9D%A5%E7%9A%84Request%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E6%8C%89%E7%85%A7%E4%B8%80%E5%AE%9A%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E6%95%B4%E7%90%86%E6%8E%92%E5%88%97%EF%BC%8C%E5%85%A5%E9%98%9F%EF%BC%8C%E5%BD%93%E5%BC%95%E6%93%8E%E9%9C%80%E8%A6%81%E6%97%B6%EF%BC%8C%E4%BA%A4%E8%BF%98%E7%BB%99%E5%BC%95%E6%93%8E%E3%80%82%0A%0A-%20**Downloader%EF%BC%88%E4%B8%8B%E8%BD%BD%E5%99%A8%EF%BC%89**%EF%BC%9A%E8%B4%9F%E8%B4%A3%E4%B8%8B%E8%BD%BDScrapy%20Engine(%E5%BC%95%E6%93%8E)%E5%8F%91%E9%80%81%E7%9A%84%E6%89%80%E6%9C%89Requests%E8%AF%B7%E6%B1%82%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84Responses%E4%BA%A4%E8%BF%98%E7%BB%99Scrapy%20Engine(%E5%BC%95%E6%93%8E)%EF%BC%8C%E7%94%B1%E5%BC%95%E6%93%8E%E4%BA%A4%E7%BB%99Spider%E6%9D%A5%E5%A4%84%E7%90%86%EF%BC%8C%0A%0A-%20**Spider%EF%BC%88%E7%88%AC%E8%99%AB%EF%BC%89**%EF%BC%9A%E5%AE%83%E8%B4%9F%E8%B4%A3%E5%A4%84%E7%90%86%E6%89%80%E6%9C%89Responses%2C%E4%BB%8E%E4%B8%AD%E5%88%86%E6%9E%90%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E8%8E%B7%E5%8F%96Item%E5%AD%97%E6%AE%B5%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E5%B0%86%E9%9C%80%E8%A6%81%E8%B7%9F%E8%BF%9B%E7%9A%84URL%E6%8F%90%E4%BA%A4%E7%BB%99%E5%BC%95%E6%93%8E%EF%BC%8C%E5%86%8D%E6%AC%A1%E8%BF%9B%E5%85%A5Scheduler(%E8%B0%83%E5%BA%A6%E5%99%A8)%EF%BC%8C%0A%0A-%20**Item%20Pipeline(%E7%AE%A1%E9%81%93)**%EF%BC%9A%E5%AE%83%E8%B4%9F%E8%B4%A3%E5%A4%84%E7%90%86Spider%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84Item%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%BF%9B%E8%A1%8C%E5%90%8E%E6%9C%9F%E5%A4%84%E7%90%86%EF%BC%88%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90%E3%80%81%E8%BF%87%E6%BB%A4%E3%80%81%E5%AD%98%E5%82%A8%E7%AD%89%EF%BC%89%E7%9A%84%E5%9C%B0%E6%96%B9.%0A%0A-%20**Downloader%20Middlewares**%EF%BC%88%E4%B8%8B%E8%BD%BD%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%89%EF%BC%9A%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E6%89%A9%E5%B1%95%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD%E7%9A%84%E7%BB%84%E4%BB%B6%EF%BC%88%E4%BB%A3%E7%90%86%E3%80%81cokies%E7%AD%89%EF%BC%89%E3%80%82%0A%0A-%20**Spider%20Middlewares**%EF%BC%88Spider%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%89%EF%BC%9A%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E6%89%A9%E5%B1%95%E5%92%8C%E6%93%8D%E4%BD%9C%E5%BC%95%E6%93%8E%E5%92%8CSpider%E4%B8%AD%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6%EF%BC%88%E6%AF%94%E5%A6%82%E8%BF%9B%E5%85%A5Spider%E7%9A%84Responses%3B%E5%92%8C%E4%BB%8ESpider%E5%87%BA%E5%8E%BB%E7%9A%84Requests%EF%BC%89%0A%0A!%5Bscrapypricture2%5D(https%3A%2F%2Fi.loli.net%2F2018%2F12%2F17%2F5c17863914b96.png)%0A**%E6%B3%A8%E6%84%8F%EF%BC%81%E5%8F%AA%E6%9C%89%E5%BD%93%E8%B0%83%E5%BA%A6%E5%99%A8%E4%B8%AD%E4%B8%8D%E5%AD%98%E5%9C%A8%E4%BB%BB%E4%BD%95request%E4%BA%86%EF%BC%8C%E6%95%B4%E4%B8%AA%E7%A8%8B%E5%BA%8F%E6%89%8D%E4%BC%9A%E5%81%9C%E6%AD%A2%EF%BC%8C%EF%BC%88%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%EF%BC%8C%E5%AF%B9%E4%BA%8E%E4%B8%8B%E8%BD%BD%E5%A4%B1%E8%B4%A5%E7%9A%84URL%EF%BC%8CScrapy%E4%B9%9F%E4%BC%9A%E9%87%8D%E6%96%B0%E4%B8%8B%E8%BD%BD%E3%80%82%EF%BC%89**%0A%0A%0A%23%23%20**Scrapy%E7%9A%84%E5%AE%89%E8%A3%85%E4%BB%8B%E7%BB%8D**%0A%0AScrapy%E6%A1%86%E6%9E%B6%E5%AE%98%E6%96%B9%E7%BD%91%E5%9D%80%EF%BC%9Ahttp%3A%2F%2Fdoc.scrapy.org%2Fen%2Flatest%0A%0AScrapy%E4%B8%AD%E6%96%87%E7%BB%B4%E6%8A%A4%E7%AB%99%E7%82%B9%EF%BC%9Ahttp%3A%2F%2Fscrapy-chs.readthedocs.io%2Fzh_CN%2Flatest%2Findex.html%0A%0A%0A**Windows%20%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F**%0A-%20Python%203%0A-%20%E5%8D%87%E7%BA%A7pip%E7%89%88%E6%9C%AC%EF%BC%9A%0A%3E%20pip3%20install%20--upgrade%20pip%0A-%20%E9%80%9A%E8%BF%87pip%20%E5%AE%89%E8%A3%85%20Scrapy%20%E6%A1%86%E6%9E%B6%20%0A%3E%20pip3%20install%20Scrapy%0A%0A%0A**Ubuntu%20%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F**%0A%0A-%20%E9%80%9A%E8%BF%87pip3%20%E5%AE%89%E8%A3%85%20Scrapy%20%E6%A1%86%E6%9E%B6%20%0A%0A%3E%20sudo%20pip3%20install%20scrapy%0A%0A**%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E4%B8%8D%E6%88%90%E5%8A%9F%E5%86%8D%E8%AF%95%E7%9D%80%E6%B7%BB%E5%8A%A0%E8%BF%99%E4%BA%9B%E4%BE%9D%E8%B5%96%E5%BA%93**%EF%BC%9A%0A%0A-%20%E5%AE%89%E8%A3%85%E9%9D%9EPython%E7%9A%84%E4%BE%9D%E8%B5%96%20%0A%3Esudo%20apt-get%20install%20python3-dev%20python-pip%20libxml2-dev%20libxslt1-dev%20zlib1g-dev%20libffi-dev%20libssl-dev%0A%0A**%E5%AE%89%E8%A3%85%E5%90%8E%EF%BC%8C%E5%8F%AA%E8%A6%81%E5%9C%A8%E5%91%BD%E4%BB%A4%E7%BB%88%E7%AB%AF%E8%BE%93%E5%85%A5%20scrapy%EF%BC%8C%E6%8F%90%E7%A4%BA%E7%B1%BB%E4%BC%BC%E4%BB%A5%E4%B8%8B%E7%BB%93%E6%9E%9C%EF%BC%8C%E4%BB%A3%E8%A1%A8%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F**%0A%0A!%5BDeepinScrot-2131%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd6f1c48598d.png)%0A%0A--------------------------------------------------------%0A%0A%23%23%20scrapy%20%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%E5%92%8C%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E8%AF%B4%E6%98%8E%0A%0A**%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87**%0A%0A-%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAScrapy%E9%A1%B9%E7%9B%AE%0A-%20%E5%AE%9A%E4%B9%89%E6%8F%90%E5%8F%96%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE(Item)%0A-%20%E7%BC%96%E5%86%99%E7%88%AC%E5%8F%96%E7%BD%91%E7%AB%99%E7%9A%84%20Spider%20%E5%B9%B6%E6%8F%90%E5%8F%96%E5%87%BA%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE(Item)%0A-%20%E7%BC%96%E5%86%99%20Item%20Pipelines%20%E6%9D%A5%E5%AD%98%E5%82%A8%E6%8F%90%E5%8F%96%E5%88%B0%E7%9A%84Item(%E5%8D%B3%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE)%0A%0A%23%23%23%20%E4%B8%80.%20%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE(scrapy%20startproject)%0A%E5%9C%A8%E5%BC%80%E5%A7%8B%E7%88%AC%E5%8F%96%E4%B9%8B%E5%89%8D%EF%BC%8C%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84Scrapy%E9%A1%B9%E7%9B%AE%E3%80%82%E8%BF%9B%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E4%B8%AD%EF%BC%8C%E8%BF%90%E8%A1%8C%E4%B8%8B%E5%88%97%E5%91%BD%E4%BB%A4%EF%BC%9A%0A%0A%3E%20scrapy%20startproject%20%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE%E5%90%8D%E7%A7%B0%0A%0A%0A%23%23%23%20**%E6%A1%88%E4%BE%8B%E4%B8%80%EF%BC%88jobbole%EF%BC%89**%0A%0A%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE(scrapy%20startproject)%0A%E5%9C%A8%E5%BC%80%E5%A7%8B%E7%88%AC%E5%8F%96%E4%B9%8B%E5%89%8D%EF%BC%8C%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84Scrapy%E9%A1%B9%E7%9B%AE%E3%80%82%E8%BF%9B%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E4%B8%AD%EF%BC%8C%E8%BF%90%E8%A1%8C%E4%B8%8B%E5%88%97%E5%91%BD%E4%BB%A4%EF%BC%9A%0A%0A-%20**%E5%88%9B%E5%BB%BA%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE**%0A%3E%20scrapy%20startproject%20jobboleproject%0A%0A!%5B%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-05-08%20%E4%B8%8B%E5%8D%889.22.47%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd69464121da.png)%0A%0A-%20**%E6%96%B0%E5%BB%BA%E7%88%AC%E8%99%AB%E6%96%87%E4%BB%B6**%0A%3E%20scrapy%20genspider%20jobbole%20%20jobbole.com%0A%0A!%5B7CB8B25E-6ED3-4D37-A886-DAA0338575AF%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd693d8e117a.png)%0A%0A%23%23%23%20**%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%3A%E4%B8%AA%E4%BA%BA%E6%80%9D%E8%B7%AF%E4%B8%8D%E5%90%8C%E5%86%99%E4%BB%A3%E7%A0%81%E7%9A%84%E5%85%88%E5%90%8E%E9%A1%BA%E5%BA%8F%E5%8F%AF%E8%83%BD%E6%9C%89%E6%89%80%E5%B7%AE%E5%BC%82**%0A%0A-%20**%E7%9B%AE%E6%A0%87%E7%BD%91%E5%9D%80%3A**%20http%3A%2F%2Fblog.jobbole.com%2Fall-posts%2F%0A%0A-%20**%E9%9C%80%E6%B1%82**%20%E8%8E%B7%E5%8F%96jobbole%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E7%AB%A0%E4%BF%A1%E6%81%AF%E3%80%82%0A%0A%23%23%23%23%20**%E6%A0%B9%E6%8D%AE%E7%9B%AE%E6%A0%87%E7%BD%91%E7%AB%99%E5%88%86%E6%9E%90%E9%9C%80%E8%A6%81%E6%8F%90%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%9C%A8item.py%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5**%0A-%20**%E6%89%93%E5%BC%80jobboleproject%E6%96%87%E4%BB%B6%E4%B8%8B%E7%9A%84item.py%E6%96%87%E4%BB%B6**%0A-%20**item%20%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5%EF%BC%8C%E7%94%A8%E6%9D%A5%E4%BF%9D%E5%AD%98%E7%88%AC%E5%8F%96%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%9C%89%E7%82%B9%E5%83%8FPython%E4%B8%AD%E7%9A%84dict%EF%BC%8C%E4%BD%86%E6%98%AF%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%BA%9B%E9%A2%9D%E5%A4%96%E7%9A%84%E4%BF%9D%E6%8A%A4%E5%87%8F%E5%B0%91%E9%94%99%E8%AF%AF**%E3%80%82%0A-%20**%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%20scrapy.Item%20%E7%B1%BB%EF%BC%8C%20%E5%B9%B6%E4%B8%94%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E4%B8%BA%20scrapy.Field%E7%9A%84%E7%B1%BB%E5%B1%9E%E6%80%A7%E6%9D%A5%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAItem%EF%BC%88%E5%8F%AF%E4%BB%A5%E7%90%86%E8%A7%A3%E6%88%90%E7%B1%BB%E4%BC%BC%E4%BA%8EORM%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB%EF%BC%89**%0A%0A%0A%23%23%23%23%20**%EF%BC%88jobboleproject%2Fitem.py%EF%BC%89%E6%96%87%E4%BB%B6**%0A%60%60%60%0Aclass%20JobboleItem(scrapy.Item)%3A%0A%0A%20%20%20%20%23%20define%20the%20fields%20for%20your%20item%20here%20like%3A%0A%20%20%20%20%23%E6%A0%87%E9%A2%98%0A%20%20%20%20title%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E5%88%9B%E5%BB%BA%E6%97%B6%E9%97%B4%0A%20%20%20%20create_date%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E5%9C%B0%E5%9D%80%0A%20%20%20%20url%20%3D%20scrapy.Field()%0A%20%20%20%20%23id%0A%20%20%20%20url_object_id%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%0A%20%20%20%20front_image_url%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%E5%9C%B0%E5%9D%80%0A%20%20%20%20front_image_path%20%3D%20scrapy.Field()%0A%20%20%20%20%23%20%E7%82%B9%E8%B5%9E%E6%95%B0%0A%20%20%20%20praise_nums%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%94%B6%E8%97%8F%E6%95%B0%0A%20%20%20%20bookmark_nums%20%3D%20scrapy.Field()%0A%20%20%20%20%23%20%E8%AF%84%E8%AE%BA%E6%95%B0%0A%20%20%20%20comment_nums%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E5%86%85%E5%AE%B9%0A%20%20%20%20content%20%3D%20scrapy.Field()%0A%20%20%20%20%23%E6%A0%87%E7%AD%BE%0A%20%20%20%20tags%20%3D%20scrapy.Field()%0A%60%60%60%0A%0A%23%23%23%20**%E5%88%B6%E4%BD%9C%E7%88%AC%E8%99%AB%20%EF%BC%88jobboleproject%2Fspiders%2Fjobbole.py%EF%BC%89**%0A%0A%E6%89%93%E5%BC%80%20jobboleproject%2Fspider%E7%9B%AE%E5%BD%95%E9%87%8C%E7%9A%84%20jobbole.py%EF%BC%8C%E9%BB%98%E8%AE%A4%E5%A2%9E%E5%8A%A0%E4%BA%86%E4%B8%8B%E5%88%97%E4%BB%A3%E7%A0%81%3A%0A%0A**jobbole.py**%0A%60%60%60%0A%23%20-*-%20coding%3A%20utf-8%20-*-%0Aimport%20scrapy%0Aclass%20JobboleSpider(scrapy.Spider)%3A%0A%0A%20%20%20%20name%20%3D%20'jobbole'%0A%20%20%20%20allowed_domains%20%3D%20%5B'jobbole.com'%5D%0A%20%20%20%20start_urls%20%3D%20%5B'http%3A%2F%2Fblog.jobbole.com%2Fall-posts%2F'%5D%0A%0Adef%20parse(self%2C%20response)%3A%0A%20%20%20%20pass%0A%60%60%60%0A%0A%E5%85%B6%E5%AE%9E%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%B1%E6%88%91%E4%BB%AC%E8%87%AA%E8%A1%8C%E5%88%9B%E5%BB%BAjobbole.py%E5%B9%B6%E7%BC%96%E5%86%99%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%8F%AA%E4%B8%8D%E8%BF%87%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%8F%AF%E4%BB%A5%E5%85%8D%E5%8E%BB%E7%BC%96%E5%86%99%E5%9B%BA%E5%AE%9A%E4%BB%A3%E7%A0%81%E7%9A%84%E9%BA%BB%E7%83%A6%0A%E8%A6%81%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AASpider%EF%BC%8C%20%E4%BD%A0%E5%BF%85%E9%A1%BB%E7%94%A8scrapy.Spider%E7%B1%BB%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AD%90%E7%B1%BB%EF%BC%8C%E5%B9%B6%E7%A1%AE%E5%AE%9A%E4%BA%86%E4%B8%89%E4%B8%AA%E5%BC%BA%E5%88%B6%E7%9A%84%E5%B1%9E%E6%80%A7%20%E5%92%8C%20%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E3%80%82%0A-%20**name%20%3D%20%22%22%20%EF%BC%9A%E8%BF%99%E4%B8%AA%E7%88%AC%E8%99%AB%E7%9A%84%E8%AF%86%E5%88%AB%E5%90%8D%E7%A7%B0%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%98%AF%E5%94%AF%E4%B8%80%E7%9A%84%EF%BC%8C%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E7%88%AC%E8%99%AB%E5%BF%85%E9%A1%BB%E5%AE%9A%E4%B9%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%90%8D%E5%AD%97**%E3%80%82%0A-%20**allow_domains%20%3D%20%5B%5D%20%E6%98%AF%E6%90%9C%E7%B4%A2%E7%9A%84%E5%9F%9F%E5%90%8D%E8%8C%83%E5%9B%B4%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E7%88%AC%E8%99%AB%E7%9A%84%E7%BA%A6%E6%9D%9F%E5%8C%BA%E5%9F%9F%EF%BC%8C%E8%A7%84%E5%AE%9A%E7%88%AC%E8%99%AB%E5%8F%AA%E7%88%AC%E5%8F%96%E8%BF%99%E4%B8%AA%E5%9F%9F%E5%90%8D%E4%B8%8B%E7%9A%84%E7%BD%91%E9%A1%B5%EF%BC%8C%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84URL%E4%BC%9A%E8%A2%AB%E5%BF%BD%E7%95%A5**%E3%80%82%0A-%20**start_urls%20%3D%20()%20%EF%BC%9A%E7%88%AC%E5%8F%96%E7%9A%84URL%E5%85%83%E7%A5%96%2F%E5%88%97%E8%A1%A8%E3%80%82%E7%88%AC%E8%99%AB%E4%BB%8E%E8%BF%99%E9%87%8C%E5%BC%80%E5%A7%8B%E6%8A%93%E5%8F%96%E6%95%B0%E6%8D%AE%EF%BC%8C%E6%89%80%E4%BB%A5%EF%BC%8C%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B0%86%E4%BC%9A%E4%BB%8E%E8%BF%99%E4%BA%9Burls%E5%BC%80%E5%A7%8B%E3%80%82%E5%85%B6%E4%BB%96%E5%AD%90URL%E5%B0%86%E4%BC%9A%E4%BB%8E%E8%BF%99%E4%BA%9B%E8%B5%B7%E5%A7%8BURL%E4%B8%AD%E7%BB%A7%E6%89%BF%E6%80%A7%E7%94%9F%E6%88%90**%E3%80%82%0A-%20**parse(self%2C%20response)%20%EF%BC%9A%E8%A7%A3%E6%9E%90%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E6%AF%8F%E4%B8%AA%E5%88%9D%E5%A7%8BURL%E5%AE%8C%E6%88%90%E4%B8%8B%E8%BD%BD%E5%90%8E%E5%B0%86%E8%A2%AB%E8%B0%83%E7%94%A8%EF%BC%8C%E8%B0%83%E7%94%A8%E7%9A%84%E6%97%B6%E5%80%99%E4%BC%A0%E5%85%A5%E4%BB%8E%E6%AF%8F%E4%B8%80%E4%B8%AAURL%E4%BC%A0%E5%9B%9E%E7%9A%84Response%E5%AF%B9%E8%B1%A1%E6%9D%A5%E4%BD%9C%E4%B8%BA%E5%94%AF%E4%B8%80%E5%8F%82%E6%95%B0**%EF%BC%8C%E4%B8%BB%E8%A6%81%E4%BD%9C%E7%94%A8%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%20%20%20%20-%20%E8%B4%9F%E8%B4%A3%E8%A7%A3%E6%9E%90%E8%BF%94%E5%9B%9E%E7%9A%84%E7%BD%91%E9%A1%B5%E6%95%B0%E6%8D%AE(response.body)%EF%BC%8C%E6%8F%90%E5%8F%96%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE(%E7%94%9F%E6%88%90item)%0A%20%20%20%20-%20%E7%94%9F%E6%88%90%E9%9C%80%E8%A6%81%E4%B8%8B%E4%B8%80%E9%A1%B5%E7%9A%84URL%E8%AF%B7%E6%B1%82%E3%80%82%0A%0A%E5%B0%86start_urls(%E8%AE%BE%E7%BD%AE%E8%B5%B7%E5%A7%8Burl)%E7%9A%84%E5%80%BC%E4%BF%AE%E6%94%B9%E4%B8%BA%E9%9C%80%E8%A6%81%E7%88%AC%E5%8F%96%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAurl%0A%60%60%60%0Astart_urls%20%3D%20(%22http%3A%2F%2Fblog.jobbole.com%2Fall-posts%2F%22%2C)%0A%60%60%60%0A%0A%23%23%23%23%20**%E5%88%86%E6%9E%90%E7%BD%91%E7%AB%99%E7%BB%93%E6%9E%84%E5%8F%96%E6%95%B0%E6%8D%AE**%0A%0A%E7%88%AC%E5%8F%96%E6%95%B4%E4%B8%AA%E7%BD%91%E9%A1%B5%E5%AE%8C%E6%AF%95%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E5%B0%B1%E6%98%AF%E7%9A%84%E5%8F%96%E8%BF%87%E7%A8%8B%E4%BA%86%EF%BC%8C%E9%A6%96%E5%85%88%E8%A7%82%E5%AF%9F%E9%A1%B5%E9%9D%A2%E6%BA%90%E7%A0%81%EF%BC%9A%0A%0A%E6%88%91%E4%BB%AC%E6%9C%AC%E6%AC%A1%E6%A1%88%E4%BE%8B%E5%88%86%E4%B8%BA%E4%B8%A4%E6%AD%A5%E6%9D%A5%E8%B5%B0%0A%0A**step1%3A**%0A%E8%8E%B7%E5%8F%96%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%89%80%E6%9C%89%E6%96%87%E7%AB%A0%E7%9A%84%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E5%92%8C%E8%AF%A6%E6%83%85%E5%9C%B0%E5%9D%80%0A%0A!%5B1B9FD3F2-C94E-49C4-B888-E509B9A411AD%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd694d738a04.png)%0A%0A!%5BE43EB93C-007D-43E1-B6D0-52C137750575%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd6950a22c1c.png)%0A%0A**step2%3A**%0A%E8%8E%B7%E5%8F%96%E5%88%B0%E6%96%87%E7%AB%A0%E7%9A%84%E9%93%BE%E6%8E%A5list%E5%92%8C%E5%9B%BE%E7%89%87list%E4%B9%8B%E5%90%8E%E6%88%91%E4%BB%AC%EF%BC%8C%E9%80%9A%E8%BF%87%E6%96%87%E7%AB%A0%E7%9A%84%E9%93%BE%E6%8E%A5%E8%8E%B7%E5%8F%96%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85%E9%87%8C%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C%E8%BF%99%E9%87%8C%0A%E5%88%97%E4%B8%BE%E9%83%A8%E5%88%86%EF%BC%8C%E5%85%B6%E5%AE%83%E7%9A%84%E8%87%AA%E8%A1%8C%E6%9F%A5%E7%9C%8B%0A%0A!%5BAFC2327B-33D3-4991-B9B9-0488169B1114%5D(https%3A%2F%2Fi.loli.net%2F2018%2F10%2F29%2F5bd695302e13e.png)%0A%0A%E6%98%AF%E4%B8%8D%E6%98%AF%E4%B8%80%E7%9B%AE%E4%BA%86%E7%84%B6%EF%BC%9F%E7%9B%B4%E6%8E%A5%E4%B8%8AXPath%E5%BC%80%E5%A7%8B%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE%E5%90%A7%E3%80%82%0A%E6%88%91%E4%BB%AC%E4%B9%8B%E5%89%8D%E5%9C%A8jobboleproject%2Fitems.py%20%E9%87%8C%E5%AE%9A%E4%B9%89%E4%BA%86%E4%B8%80%E4%B8%AA%0AJobboleprojectItem%20%E7%B1%BB%E3%80%82%20%E8%BF%99%E9%87%8C%E5%BC%95%E5%85%A5%E8%BF%9B%E6%9D%A5%0A%0A%23%23%23%23%20**%E5%9C%A8parse%E6%96%B9%E6%B3%95%E4%B8%AD%E5%81%9A%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8F%90%E5%8F%96**%0A%60%60%60%0Afrom%20jobboleproject.items%20import%20JobboleprojectItem%0A%0A1.%E8%8E%B7%E5%8F%96%E5%9B%BE%E7%89%87%E5%92%8C%E6%96%87%E7%AB%A0%E8%AF%A6%E6%83%85%E7%9A%84%E9%93%BE%E6%8E%A5%0Adef%20parse(self%2C%20response)%3A%0A%20%20%20%20%0A%20%20%20%20%23%20css%E9%80%89%E6%8B%A9%E5%99%A8%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%89%80%E6%9C%89%E7%9A%84%E8%8A%82%E7%82%B9%0A%20%20%20%20post_nodes%20%3D%20response.css(%22%23archive%20.floated-thumb%20.post-thumb%20a%22)%0A%0A%20%20%20%20%23%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E6%98%AF%E5%AE%8C%E6%95%B4%E7%9A%84%E5%9F%9F%E5%90%8D%20%E9%9C%80%E8%A6%81%E6%8B%BC%E6%8E%A5%E5%AE%8C%E6%95%B4%20response.url%20%2B%20post_url%0A%20%20%20%20%23%20%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84URL%E5%8F%AF%E8%83%BD%E4%B8%8D%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%9F%E5%90%8D%EF%BC%8C%E4%B9%9F%E5%8F%AF%E8%83%BD%E6%98%AF%E5%85%B7%E4%BD%93%E7%9A%84%E6%96%87%E7%AB%A0%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8parse%E5%87%BD%E6%95%B0from%20urllib%20import%20parse%0A%20%20%20%20for%20post_node%20in%20post_nodes%3A%0A%20%20%20%20%20%20%20%20image_url%20%3D%20post_node.css(%22img%3A%3Aattr(src)%22).extract_first(%22%22)%0A%20%20%20%20%20%20%20%20post_url%20%3D%20post_node.css(%22%3A%3Aattr(href)%22).extract_first(%22%22)%0A%20%20%20%20%20%20%20%20full_url%20%3D%20response.urljoin(post_url)%0A%20%20%20%20%20%20%20%20%23meta%E5%8F%82%E6%95%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8%EF%BC%8C%E7%94%A8%E6%9D%A5%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE%0A%20%20%20%20%20%20%20%20yield%20scrapy.Request(url%3Dfull_url%2C%20meta%3D%7B%22front_image_url%22%3A%20image_url%7D%2C%0A%20%20%20%20%20%20%20%20callback%3Dself.parse_detail)%0A%0A2.%E7%84%B6%E5%90%8E%E5%B0%86%E6%88%91%E4%BB%AC%E5%BE%97%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85%E5%88%B0%E4%B8%80%E4%B8%AA%20JobboleItem%20%E5%AF%B9%E8%B1%A1%E4%B8%AD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BF%9D%E5%AD%98%E6%AF%8F%E4%B8%AA%E6%96%87%E7%AB%A0%E7%9A%84%E5%B1%9E%E6%80%A7%EF%BC%9A%0Adef%20parse_detail(self%2Cresponse)%3A%0A%20%20%20%20%23%20print(response)%0A%20%20%20%20%23%20%E4%BD%BF%E7%94%A8xpath%E8%AF%AD%E6%B3%95%E6%88%96%E8%80%85css%E8%AF%AD%E6%B3%95%E6%8F%90%E5%8F%96%E7%BD%91%E9%A1%B5%E7%9A%84%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%0A%20%20%20%20%23%20extract%EF%BC%88%EF%BC%89%20%E4%B8%B2%E8%A1%8C%E5%8C%96%E5%B9%B6%E5%B0%86%E5%8C%B9%E9%85%8D%E5%88%B0%E7%9A%84%E8%8A%82%E7%82%B9%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AAunicode%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%97%E8%A1%A8%0A%0A%20%20%20%20item%20%3D%20JobboleprojectItem()%0A%20%20%20%20%23%E6%A0%87%E9%A2%98%0A%20%20%20%20item%5B'title'%5D%20%3D%20response.xpath('%2F%2Fdiv%5B%40class%3D%22entry-header%22%5D%2Fh1%2Ftext()').extract_frist(%22%22)%0A%0A%20%20%20%20%23%E5%8F%91%E5%B8%83%E6%97%A5%E6%9C%9F%0A%20%20%20%20item%5B'create_date'%5D%20%3D%20response.xpath(%22%2F%2Fp%5B%40class%3D'entry-meta-hide-on-mobile'%5D%2Ftext()%22).extract_first(%22%22).strip().replace(%22%C2%B7%22%2C%22%22).strip()%0A%20%20%20%20%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E5%9C%B0%E5%9D%80%E8%AF%A6%E6%83%85%E5%9C%B0%E5%9D%80%0A%20%20%20%20item%5B'url'%5D%20%3D%20response.url%0A%20%20%20%20%23%20http%3A%2F%2Fblog.jobbole.com%2F113949%2F%0A%0A%20%20%20%20%23%E6%96%87%E7%AB%A0%E7%9A%84id%0A%20%20%20%20item%5B'url_object_id'%5D%20%3D%20re.match(%22.*%3F(%5Cd%2B).*%22%2C%20url).group(1)%0A%0A%20%20%20%20%23%20%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%0A%20%20%20%20item%5B'front_image_url'%5D%20%3D%20response.meta.get(%22front_image_url%22%2C%22%22)%0A%0A%20%20%20%20%23%20%E7%82%B9%E8%B5%9E%E6%95%B0%0A%20%20%20%20item%5B'praise_nums'%5D%20%3D%20response.xpath(%22%2F%2Fspan%5Bcontains(%40class%2C'vote-post-up')%5D%2Fh10%2Ftext()%22).extract_first(%22%22)%0A%0A%20%20%20%20%23%20%E6%94%B6%E8%97%8F%E6%95%B0%0A%20%20%20%20bookmark_nums%20%3D%20response.xpath(%22%2F%2Fspan%5Bcontains(%40class%2C'bookmark-btn')%5D%2Ftext()%22).extract_first(%22%22)%0A%20%20%20%20match_bookmark_nums%20%3D%20re.match(%22.*%3F(%5Cd%2B).*%22%2Cbookmark_nums)%0A%20%20%20%20if%20match_bookmark_nums%3A%0A%20%20%20%20%20%20%20%20item%5B'bookmark_nums'%5D%20%3D%20int(match_bookmark_nums.group(1))%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20item%5B'bookmark_nums'%5D%20%3D%200%0A%0A%20%20%20%20%23%20%E8%AF%84%E8%AE%BA%E6%95%B0%0A%20%20%20%20comment_nums%20%3D%20response.xpath(%22%2F%2Fa%5B%40href%3D'%23article-comment'%5D%2Fspan%2Ftext()%22).extract_first(%22%22)%0A%20%20%20%20match_comment_nums%20%3D%20re.match(%22.*%3F(%5Cd%2B).*%22%2Ccomment_nums)%0A%20%20%20%20if%20match_comment_nums%3A%0A%20%20%20%20%20%20%20%20item%5B'comment_nums'%5D%20%3D%20int(match_comment_nums.group(1))%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20item%5B'comment_nums'%5D%20%3D%200%0A%20%20%20%20%23%20%E6%96%87%E7%AB%A0%E5%86%85%E5%AE%B9%0A%20%20%20%20item%5B'content'%5D%20%3D%20response.xpath(%22%2F%2Fdiv%5B%40class%3D'entry'%5D%22).extract_first(%22%22)%0A%20%20%20%20%23%20%E8%BF%87%E6%BB%A4%E8%AF%84%E8%AE%BA%E6%A0%87%E7%AD%BE%0A%20%20%20%20tag_list%20%3D%20response.xpath(%22%2F%2Fp%5B%40class%3D'entry-meta-hide-on-mobile'%5D%2F%2Fa%2Ftext()%22).extract()%0A%20%20%20%20tag_list%20%3D%20%5Belement%20for%20element%20in%20tag_list%20if%20not%20element.strip().endswith(%22%E8%AF%84%E8%AE%BA%22)%5D%0A%20%20%20%20%20%23%20%E6%A0%87%E7%AD%BE%0A%20%20%20%20item%5B'tags'%5D%20%3D%20%22%2C%22.join(tag_list)%0A%20%20%20%20print(item)%0A%20%20%20%20%23%20yield%E5%B0%86%E8%8E%B7%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BA%A4%E7%BB%99pipelines%0A%20%20%20%20yield%20item%0A%60%60%60%0A%0A%0A**%E5%85%B3%E4%BA%8Eyeild%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D**%EF%BC%9A%0A%0A%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99%E8%AF%B4%E6%98%8E%EF%BC%9Ahttps%3A%2F%2Fblog.csdn.net%2Fu013205877%2Farticle%2Fdetails%2F70332612%0Ahttps%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Fopensource%2Fos-cn-python-yield%2F%0A%0A%E7%AE%80%E5%8D%95%E5%9C%B0%E8%AE%B2%EF%BC%8C**yield%20%E7%9A%84%E4%BD%9C%E7%94%A8%E5%B0%B1%E6%98%AF%E6%8A%8A%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%98%E6%88%90%E4%B8%80%E4%B8%AA%20generator%EF%BC%88%E7%94%9F%E6%88%90%E5%99%A8%EF%BC%89%EF%BC%8C%E5%B8%A6%E6%9C%89%20yield%20%E7%9A%84%E5%87%BD%E6%95%B0%E4%B8%8D%E5%86%8D%E6%98%AF%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0%EF%BC%8CPython%20%E8%A7%A3%E9%87%8A%E5%99%A8%E4%BC%9A%E5%B0%86%E5%85%B6%E8%A7%86%E4%B8%BA%E4%B8%80%E4%B8%AA%20generator**%EF%BC%8C%E5%B8%A6%E6%9C%89yeild%E7%9A%84%E5%87%BD%E6%95%B0%E9%81%87%E5%88%B0yeild%E7%9A%84%E6%97%B6%E5%80%99%E5%B0%B1%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%80%BC%EF%BC%8C%E4%B8%8B%E6%AC%A1%E8%BF%AD%E4%BB%A3%E6%97%B6%EF%BC%8C%0A%E4%BB%A3%E7%A0%81%E4%BB%8E%20yield%20%E7%9A%84%E4%B8%8B%E4%B8%80%E6%9D%A1%E8%AF%AD%E5%8F%A5%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E8%80%8C%E5%87%BD%E6%95%B0%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%92%8C%E4%B8%8A%E6%AC%A1%E4%B8%AD%E6%96%AD%E6%89%A7%E8%A1%8C%E5%89%8D%E6%98%AF%E5%AE%8C%E5%85%A8%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%8C%E4%BA%8E%E6%98%AF%E5%87%BD%E6%95%B0%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%0A%E7%9B%B4%E5%88%B0%E5%86%8D%E6%AC%A1%E9%81%87%E5%88%B0%20yield%E3%80%82%0A%0A%E9%80%9A%E4%BF%97%E7%9A%84%E8%AE%B2%E5%B0%B1%E6%98%AF%EF%BC%9A%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%AD%EF%BC%8C%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E5%88%B0yield%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E7%A8%8B%E5%BA%8F%E6%9A%82%E5%81%9C%EF%BC%8C%E8%BF%94%E5%9B%9Eyield%E5%90%8E%E9%9D%A2%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%80%BC%EF%BC%8C%E5%9C%A8%E4%B8%8B%E4%B8%80%E6%AC%A1%E8%B0%83%E7%94%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BB%8Eyield%E8%AF%AD%E5%8F%A5%E6%9A%82%E5%81%9C%E7%9A%84%E5%9C%B0%E6%96%B9%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%AD%A4%E5%BE%AA%E7%8E%AF%EF%BC%8C%E7%9B%B4%E5%88%B0%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E5%AE%8C%E3%80%82%0A%0A%0A-------------------------------------------------------%0A%0A%23%23%20Scrapy%20Item%20pipeline(%E7%AE%A1%E9%81%93%E6%96%87%E4%BB%B6)%E4%BD%BF%E7%94%A8%0A%0A**Item%20Pipeline**%0A%0A%E5%BD%93Item%E5%9C%A8Spider%E4%B8%AD%E8%A2%AB%E6%94%B6%E9%9B%86%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%AE%83%E5%B0%86%E4%BC%9A%E8%A2%AB%E4%BC%A0%E9%80%92%E5%88%B0Item%20Pipeline%EF%BC%8C%E8%BF%99%E4%BA%9BItem%20Pipeline%E7%BB%84%E4%BB%B6%E6%8C%89%E5%AE%9A%E4%B9%89%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%A4%84%E7%90%86Item%E3%80%82%0A%0A%E6%AF%8F%E4%B8%AAItem%20Pipeline%E9%83%BD%E6%98%AF%E5%AE%9E%E7%8E%B0%E4%BA%86%E7%AE%80%E5%8D%95%E6%96%B9%E6%B3%95%E7%9A%84Python%E7%B1%BB%EF%BC%8C%E6%AF%94%E5%A6%82%E5%86%B3%E5%AE%9A%E6%AD%A4Item%E6%98%AF%E4%B8%A2%E5%BC%83%E8%80%8C%E5%AD%98%E5%82%A8%E3%80%82%E4%BB%A5%E4%B8%8B%E6%98%AFitem%20pipeline%E7%9A%84%E4%B8%80%E4%BA%9B%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%EF%BC%9A%0A%0A-%20%E9%AA%8C%E8%AF%81%E7%88%AC%E5%8F%96%E7%9A%84%E6%95%B0%E6%8D%AE(%E6%A3%80%E6%9F%A5item%E5%8C%85%E5%90%AB%E6%9F%90%E4%BA%9B%E5%AD%97%E6%AE%B5%EF%BC%8C%E6%AF%94%E5%A6%82%E8%AF%B4name%E5%AD%97%E6%AE%B5)%0A-%20%E6%9F%A5%E9%87%8D(%E5%B9%B6%E4%B8%A2%E5%BC%83)%0A-%20%E5%B0%86%E7%88%AC%E5%8F%96%E7%BB%93%E6%9E%9C%E4%BF%9D%E5%AD%98%E5%88%B0%E6%96%87%E4%BB%B6%E6%88%96%E8%80%85%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%0A%0A%0A%23%23%23%23%20**%E7%BC%96%E5%86%99item%20pipeline**%0A%0A%E7%BC%96%E5%86%99item%20pipeline%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8Citem%20pipiline%E7%BB%84%E4%BB%B6%E6%98%AF%E4%B8%80%E4%B8%AA%E7%8B%AC%E7%AB%8B%E7%9A%84Python%E7%B1%BB%EF%BC%8C%E5%85%B6%E4%B8%ADprocess_item()%E6%96%B9%E6%B3%95%E5%BF%85%E9%A1%BB%E5%AE%9E%E7%8E%B0%3A%0A%0A%60%60%60%0Aimport%20something%0A%0Aclass%20SomethingPipeline(object)%3A%0A%20%20%20%20def%20__init__(self)%3A%0A%20%20%20%20%20%20%20%20%23%20%E5%8F%AF%E9%80%89%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%81%9A%E5%8F%82%E6%95%B0%E5%88%9D%E5%A7%8B%E5%8C%96%E7%AD%89%0A%20%20%20%20%20%20%20%20%23%20doing%20something%0A%0A%20%20%20%20def%20process_item(self%2C%20item%2C%20spider)%3A%0A%20%20%20%20%20%20%20%20%23%20item%20(Item%20%E5%AF%B9%E8%B1%A1)%20%E2%80%93%20%E8%A2%AB%E7%88%AC%E5%8F%96%E7%9A%84item%0A%20%20%20%20%20%20%20%20%23%20spider%20(Spider%20%E5%AF%B9%E8%B1%A1)%20%E2%80%93%20%E7%88%AC%E5%8F%96%E8%AF%A5item%E7%9A%84spider%0A%20%20%20%20%20%20%20%20%23%20%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%BF%85%E9%A1%BB%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%AF%8F%E4%B8%AAitem%20pipeline%E7%BB%84%E4%BB%B6%E9%83%BD%E9%9C%80%E8%A6%81%E8%B0%83%E7%94%A8%E8%AF%A5%E6%96%B9%E6%B3%95%EF%BC%8C%0A%20%20%20%20%20%20%20%20%23%20%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA%20Item%20%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%A2%AB%E4%B8%A2%E5%BC%83%E7%9A%84item%E5%B0%86%E4%B8%8D%E4%BC%9A%E8%A2%AB%E4%B9%8B%E5%90%8E%E7%9A%84pipeline%E7%BB%84%E4%BB%B6%E6%89%80%E5%A4%84%E7%90%86%E3%80%82%0A%20%20%20%20%20%20%20%20return%20item%0A%0A%20%20%20%20def%20open_spider(self%2C%20spider)%3A%0A%20%20%20%20%20%20%20%20%23%20spider%20(Spider%20%E5%AF%B9%E8%B1%A1)%20%E2%80%93%20%E8%A2%AB%E5%BC%80%E5%90%AF%E7%9A%84spider%0A%20%20%20%20%20%20%20%20%23%20%E5%8F%AF%E9%80%89%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%BD%93spider%E8%A2%AB%E5%BC%80%E5%90%AF%E6%97%B6%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E8%A2%AB%E8%B0%83%E7%94%A8%E3%80%82%0A%0A%20%20%20%20def%20close_spider(self%2C%20spider)%3A%0A%20%20%20%20%20%20%20%20%23%20spider%20(Spider%20%E5%AF%B9%E8%B1%A1)%20%E2%80%93%20%E8%A2%AB%E5%85%B3%E9%97%AD%E7%9A%84spider%0A%20%20%20%20%20%20%20%20%23%20%E5%8F%AF%E9%80%89%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%BD%93spider%E8%A2%AB%E5%85%B3%E9%97%AD%E6%97%B6%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E8%A2%AB%E8%B0%83%E7%94%A8%0A%0A%60%60%60%0A%0A%23%23%20%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%0A%0A%0A%23%23%23%23%20**%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5mongodb%E6%95%B0%E6%8D%AE%E5%BA%93**%0A%0A**settings.py%E6%96%87%E4%BB%B6**%3A%0A%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%9C%A8%E8%BF%99%E9%87%8C%E8%AE%BE%E7%BD%AEUser-Agent%2C%E6%BF%80%E6%B4%BB%E7%AE%A1%E9%81%93%E6%96%87%E4%BB%B6%E7%AD%89%EF%BC%8E%EF%BC%8E%EF%BC%8E%0A%60%60%60%0AITEM_PIPELINES%20%3D%20%7B%0A%20%20%20%20'douban.pipelines.DoubanPipeline'%3A%20300%2C%0A%7D%0A%0AMONGODB_HOST%20%3D%20'127.0.0.1'%20%20%23MONGODB%20%E4%B8%BB%E6%9C%BA%E5%90%8D%0AMONGODB_PORT%3D%2027017%20%23MONGODB%20%E7%AB%AF%E5%8F%A3%E5%8F%B7%0AMONGODB_DBNAME%20%3D%20%22Douban%22%20%23%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E7%A7%B0%0AMONGODB_SHEETNAME%3D%20%22doubanmovies%22%20%20%23%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%E5%90%8D%E7%A7%B0%0A%60%60%60%0A%0A**pipelines.py%E7%AE%A1%E9%81%93**%EF%BC%9A%E8%BF%99%E9%87%8C%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B8%85%E6%B4%97%E5%92%8C%E6%8C%81%E4%B9%85%E5%8C%96%0A%0A%60%60%60%0Aimport%20pymongo%0Afrom%20scrapy.conf%20import%20settings%0A%0Aclass%20DoubanPipeline(object)%3A%0A%0A%20%20%20%20%23%20%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%9C%A8mongodb%E4%B8%AD%0A%20%20%20%20def%20__init__(self%2Chost%2Cport%2Cdbname%2Csheetname)%3A%0A%20%20%20%20%20%20%20%20%23%20%E5%88%9B%E5%BB%BAMONGODB%E6%95%B0%E6%8D%AE%E5%BA%93%E9%93%BE%E6%8E%A5%0A%20%20%20%20%20%20%20%20client%20%3D%20pymongo.MongoClient(host%3Dhost%2C%20port%3Dport)%0A%20%20%20%20%20%20%20%20%23%20%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93%0A%20%20%20%20%20%20%20%20mydb%20%3D%20client%5Bdbname%5D%0A%20%20%20%20%20%20%20%20%23%20%E5%AD%98%E6%94%BE%E6%95%B0%E6%8D%AE%E7%9A%84%E9%9B%86%E5%90%88%E5%90%8D%E7%A7%B0%0A%20%20%20%20%20%20%20%20self.mysheet%20%3D%20mydb%5Bsheetname%5D%0A%0A%20%20%20%20%40classmethod%0A%20%20%20%20def%20from_crawler(cls%2C%20crawler)%3A%0A%20%20%20%20%20%20%20%20host%20%3D%20crawler.settings%5B%22MONGODB_HOST%22%5D%0A%20%20%20%20%20%20%20%20port%20%3D%20crawler.settings%5B%22MONGODB_PORT%22%5D%0A%20%20%20%20%20%20%20%20dbname%20%3D%20crawler.settings%5B%22MONGODB_DBNAME%22%5D%0A%20%20%20%20%20%20%20%20sheetname%20%3D%20crawler.settings%5B%22MONGODB_SHEETNAME%22%5D%0A%20%20%20%20%0A%20%20%20%20%20%20%20%20return%20cls(host%2Cport%2Cdbname%2Csheetname)%0A%0A%20%20%20%20def%20process_item(self%2Citem%2Cspider)%3A%0A%20%20%20%20%20%20%20%20data%20%3D%20dict(item)%0A%20%20%20%20%20%20%20%20%23%20mongodb%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E8%AF%AD%E5%8F%A5%EF%BC%8C%E4%BD%BF%E7%94%A8save%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E7%9A%84%E6%95%88%E7%8E%87%E4%BC%9A%E5%BE%88%E6%85%A2%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E9%9C%80%E8%A6%81%E5%BE%AA%E7%8E%AF%E4%BE%BF%E5%88%A9%EF%BC%8C%E6%93%8D%E4%BD%9C%E8%B4%B9%E6%97%B6%0A%20%20%20%20%20%20%20%20self.mysheet.insert(data)%0A%20%20%20%20%20%20%20%20return%20item%0A%60%60%60%0A%0A%23%23%23%20**%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5mysql%E6%95%B0%E6%8D%AE%E5%BA%93**%0A%0A**settings.py%E6%96%87%E4%BB%B6**%3A%0A%E8%AE%BE%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%9C%A8%E8%BF%99%E9%87%8C%E8%AE%BE%E7%BD%AEUser-Agent%2C%E6%BF%80%E6%B4%BB%E7%AE%A1%E9%81%93%E6%96%87%E4%BB%B6%E7%AD%89%EF%BC%8E%EF%BC%8E%EF%BC%8E%0A%60%60%60%0AITEM_PIPELINES%20%3D%20%7B%0A%20%20%20%20'douban.pipelines.DoubanPipeline'%3A%20300%2C%0A%7D%0A%0A%23%E5%85%B3%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%0AMYSQL_HOST%20%3D%20'127.0.0.1'%0AMYSQL_PORT%20%3D%203306%0AMYSQL_USER%20%3D%20'%E7%94%A8%E6%88%B7%E5%90%8D'%0AMYSQL_PWD%20%3D%20'%E5%AF%86%E7%A0%81'%0AMYSQL_DB%20%3D%20'%E6%95%B0%E6%8D%AE%E5%BA%93'%0A%60%60%60%0A%0A**pipelines.py%E7%AE%A1%E9%81%93%E6%96%87%E4%BB%B6**%0A%0A%60%60%60%0Aimport%20pymysql%0Aclass%20DoubanPipeline(object)%3A%0A%0A%23%20%20%20%20%20%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%80%BCmysql%E6%95%B0%E6%8D%AE%E5%BA%93%0A%23%20%20%20%20%20_mysql_exceptions.OperationalError%3A%20(1366%2C%20%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8Echarset%3D%22utf8%22%E4%B8%8D%E7%AC%A6%E5%90%88%0A%0A%20%20%20%20def%20__init__(self%2Chost%2Cport%2Cuser%2Cpwd%2Cdb%2Ccharset)%3A%0A%20%20%20%20%20%20%20%20self.client%20%3D%20pymysql.Connect(host%2Cuser%2Cpwd%2Cdb%2Cport%2Ccharset%3D'utf8')%0A%20%20%20%20%20%20%20%20self.cursor%20%3D%20self.client.cursor()%0A%20%20%20%20%0A%20%20%20%20%40classmethod%0A%20%20%20%20def%20from_crawler(cls%2Ccrawler)%3A%0A%20%20%20%20%20%20%20%20host%20%3D%20crawler.settings%5B'MYSQL_HOST'%5D%0A%20%20%20%20%20%20%20%20port%20%3D%20crawler.settings%5B'MYSQL_PORT'%5D%0A%20%20%20%20%20%20%20%20user%20%3D%20crawler.settings%5B'MYSQL_USER'%5D%0A%20%20%20%20%20%20%20%20pwd%20%3D%20crawler.settings%5B'MYSQL_PWD'%5D%0A%20%20%20%20%20%20%20%20db%20%3D%20crawler.settings%5B'MYSQL_DB'%5D%0A%0A%20%20%20%20%20%20%20%20return%20cls(host%2Cport%2Cuser%2Cpwd%2Cdb%2Ccharset)%0A%0A%20%20%20%20def%20process_item(self%2Citem%2Cspider)%3A%0A%20%20%20%20%20%20%20%20insert_sql%20%3D%20%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20insert%20into%20%E8%A1%A8%E5%90%8D(title%2C%20playable%2C%20content%2C%20star%2C%20commentnum%2C%20inq)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20VALUES%20(%25s%2C%20%25s%2C%20%25s%2C%20%25s%2C%20%25s%2C%20%25s)%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20self.cursor.execute(insert_sql%2C%20(item%5B'title'%5D%2C%20%20item%5B'content'%5D%2C%20item%5B'score'%5D%2C%20item%5B'info'%5D))%0A%20%20%20%20%20%20%20%20%20%20%20%20self.client.commit()%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20err%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20print(err)%0A%20%20%20%20%20%20%20%20%20%20%20%20self.client.rollback()%0A%20%20%20%20%20%20%20%20return%20item%0A%60%60%60%0A%0A**%E6%80%9D%E8%80%83%3F%3F%3F**%EF%BC%9A%0A%E5%9C%A8pipeline%E4%B8%AD%E6%88%91%E4%BB%AC%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%EF%BC%8C**%E5%A6%82%E4%BD%95%E8%A7%A3%E8%80%A6**%EF%BC%9F%0A%0A**%E5%B0%86sql%E8%AF%AD%E5%8F%A5%E5%92%8C%E8%A6%81%E6%8F%92%E5%85%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E5%9C%A8item%E4%B8%AD%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%2C%E9%80%9A%E8%BF%87item%E8%B0%83%E7%94%A8%EF%BC%8C%E7%84%B6%E5%90%8E%E8%BF%94%E5%9B%9E**%0A%0A%60%60%60%0Aclass%20XxxxItem(scrapy.Item)%3A%0A%0A%20%20%20%20%23%E5%90%8D%E7%A7%B0%0A%20%20%20%20title%20%3D%20scrapy.Field()%0A%0A%20%20%20%20def%20insert_data_to_db(self%2CdataDict)%3A%0A%20%20%20%20%20%20%20%20sql%20%3D%20%22%22%22%0A%20%20%20%20%20%20%20%20INSERT%20INTO%20caipu%20(%25s)%0A%20%20%20%20%20%20%20%20VALUES%20(%25s)%0A%20%20%20%20%20%20%20%20%22%22%22%20%25%20('%2C'.join(dataDict.keys())%2C'%2C'.join(%5B'%25s'%5D*len(dataDict)))%0A%20%20%20%20%20%20%20%20data%20%3D%20list(dataDict.values())%0A%20%20%20%20%20%20%20%20return%20sql%2Cdata%0A%60%60%60%0A%0A%23%23%23%23%20**mysql%E6%95%B0%E6%8D%AE%E5%BC%82%E6%AD%A5%E6%8F%92%E5%85%A5**%0A%0A%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%8C%E6%AD%A5%E7%9A%84%E6%96%B9%E6%B3%95%E5%B0%86%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E9%82%A3%E4%B9%88%E6%88%91%E4%BB%AC%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%BC%82%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E6%8F%92%E5%85%A5%E5%91%A2%EF%BC%9F%0A%0A-%20**settings.py%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6**%0A**%E5%B0%86mysql%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF%E5%86%99%E5%9C%A8settings%E4%B8%AD**%0A%60%60%60%0AMYSQL_HOST%20%3D%20'127.0.0.1'%0AMYSQL_ROOT%20%3D%20'%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E5%90%8D'%0AMYSQL_PASSWORD%20%3D%20'%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81'%0AMYSQL_DBNAME%20%3D%20'DouBan'%0A%60%60%60%0A%0A-%20**%E5%BC%82%E6%AD%A5%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93**%0A**pipeline%E7%AE%A1%E9%81%93%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81**%0A%60%60%60%0Aimport%20pymysql%0A%23twisted%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BC%82%E6%AD%A5%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%0A%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E5%B0%86%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%0A%23adbapi%E9%87%8C%E9%9D%A2%E7%9A%84%E5%AD%90%E7%BA%BF%E7%A8%8B%E4%BC%9A%E5%8E%BB%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%98%BB%E5%A1%9E%E6%93%8D%E4%BD%9C%EF%BC%8C%0A%E5%BD%93%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E4%B9%8B%E5%90%8E%EF%BC%8C%E5%90%8C%E6%97%B6%EF%BC%8C%E5%8E%9F%E5%A7%8B%E7%BA%BF%E7%A8%8B%E8%83%BD%E7%BB%A7%E7%BB%AD%0A%E8%BF%9B%E8%A1%8C%E6%AD%A3%E5%B8%B8%E7%9A%84%E5%B7%A5%E4%BD%9C%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%85%B6%E4%BB%96%E8%AF%B7%E6%B1%82%E3%80%82%0A%0Afrom%20twisted.enterprise%20import%20adbapi%0A%0A%23mysql%E6%95%B0%E6%8D%AE%E5%BC%82%E6%AD%A5%E6%8F%92%E5%85%A5%0Aclass%20DoubanPipeline(object)%3A%0A%0A%20%20%20%20def%20__init__(self%2Cdbpool)%3A%0A%20%20%20%20%20%20%20%20self.dbpool%20%3D%20dbpool%0A%0A%20%20%20%20%23%E4%BD%BF%E7%94%A8%E8%BF%99%E4%B8%AA%E5%87%BD%E6%95%B0%E6%9D%A5%E5%BA%94%E7%94%A8settings%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%82%0A%20%20%20%20%40classmethod%0A%20%20%20%20def%20from_crawler(cls%2C%20crawler)%3A%0A%20%20%20%20%20%20%20%20parmas%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'host'%3Acrawler.settings%5B'MYSQL_HOST'%5D%2C%0A%20%20%20%20%20%20%20%20'user'%3Acrawler.settings%5B'MYSQL_USER'%5D%2C%0A%20%20%20%20%20%20%20%20'passwd'%3Acrawler.settings%5B'MYSQL_PASSWD'%5D%2C%0A%20%20%20%20%20%20%20%20'db'%3Acrawler.settings%5B'MYSQL_DB'%5D%2C%0A%20%20%20%20%20%20%20%20'port'%3A3306%2C%0A%20%20%20%20%20%20%20%20'charset'%3A'utf8'%2C%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%23%20**%E8%A1%A8%E7%A4%BA%E5%AD%97%E5%85%B8%EF%BC%8C*tuple%E5%85%83%E7%BB%84%2C%0A%20%20%20%20%20%20%20%20%23%20%E4%BD%BF%E7%94%A8ConnectionPool%EF%BC%8C%E8%B5%B7%E5%A7%8B%E6%9C%80%E5%90%8E%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AAThreadPool%0A%20%20%20%20%20%20%20%20dbpool%20%3D%20adbapi.ConnectionPool(%0A%20%20%20%20%20%20%20%20%20%20%20%20'pymysql'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20**parmas%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20return%20cls(dbpool)%0A%0A%20%20%20%20def%20process_item(self%2C%20item%2C%20spider)%3A%0A%20%20%20%20%20%20%20%20%23%E8%BF%99%E9%87%8C%E5%8E%BB%E8%B0%83%E7%94%A8%E4%BB%BB%E5%8A%A1%E5%88%86%E9%85%8D%E7%9A%84%E6%96%B9%E6%B3%95%0A%20%20%20%20%20%20%20%20query%20%3D%20self.dbpool.runInteraction(%0A%20%20%20%20%20%20%20%20%20%20%20%20self.insert_data_todb%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20item%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20spider%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%23%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%9B%9E%E8%B0%83%0A%20%20%20%20%20%20%20%20query.addErrback(%0A%20%20%20%20%20%20%20%20%20%20%20%20self.handle_error%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20item%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%23%E6%89%A7%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E7%9A%84%E5%87%BD%E6%95%B0%0A%20%20%20%20%20%20%20%20def%20insert_data_todb(self%2Ccursor%2Citem%2Cspider)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20insert_str%2Cparmas%20%3D%20item.insertdata()%0A%20%20%20%20%20%20%20%20%20%20%20%20cursor.execute(insert_str%2Cparmas)%0A%20%20%20%20%20%20%20%20%20%20%20%20print('%E6%8F%92%E5%85%A5%E6%88%90%E5%8A%9F')%0A%0A%20%20%20%20def%20handle_error(self%2Cfailure%2Citem)%3A%0A%20%20%20%20%20%20%20%20print(failure)%0A%20%20%20%20%20%20%20%20print('%E6%8F%92%E5%85%A5%E9%94%99%E8%AF%AF')%0A%20%20%20%20%20%20%20%20%23%E5%9C%A8%E8%BF%99%E9%87%8C%E6%89%A7%E8%A1%8C%E4%BD%A0%E6%83%B3%E8%A6%81%E7%9A%84%E6%93%8D%E4%BD%9C%0A%0A%20%20%20%20def%20close_spider(self%2C%20spider)%3A%0A%20%20%20%20%20%20%20%20self.pool.close()%0A%0A%60%60%60%0A%0A**MySQL%20%E8%A7%A3%E5%86%B3%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D%E9%97%AE%E9%A2%98(%E8%87%AA%E5%AD%A6)**%0Ahttps%3A%2F%2Fblog.csdn.net%2Fzp_00000%2Farticle%2Fdetails%2F81042589%0A%0A%0A%0A</center></div></body></html>